window.NMP||function(){var e,t,i;!function(n){var o,r,s,a,l={},u={},h={},c={},p=Object.prototype.hasOwnProperty,_=[].slice,g=/\.js$/;function d(e,t){return p.call(e,t)}function f(e,t){var i,n,o,r,s,a,l,u,c,p,_,d=t&&t.split("/"),f=h.map,y=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),s=(e=e.split("/")).length-1,h.nodeIdCompat&&g.test(e[s])&&(e[s]=e[s].replace(g,"")),e=d.concat(e),c=0;c<e.length;c+=1)if("."===(_=e[c]))e.splice(c,1),c-=1;else if(".."===_){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||y)&&f){for(c=(i=e.split("/")).length;c>0;c-=1){if(n=i.slice(0,c).join("/"),d)for(p=d.length;p>0;p-=1)if((o=f[d.slice(0,p).join("/")])&&(o=o[n])){r=o,a=c;break}if(r)break;!l&&y&&y[n]&&(l=y[n],u=c)}!r&&l&&(r=l,a=u),r&&(i.splice(0,a,r),e=i.join("/"))}return e}function y(e,t){return function(){return r.apply(n,_.call(arguments,0).concat([e,t]))}}function m(e){return function(t){l[e]=t}}function S(e){if(d(u,e)){var t=u[e];delete u[e],c[e]=!0,o.apply(n,t)}if(!d(l,e)&&!d(c,e))throw new Error("No "+e);return l[e]}function b(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}s=function(e,t){var i,n=b(e),o=n[0];return e=n[1],o&&(i=S(o=f(o,t))),o?e=i&&i.normalize?i.normalize(e,function(e){return function(t){return f(t,e)}}(t)):f(e,t):(o=(n=b(e=f(e,t)))[0],e=n[1],o&&(i=S(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:i}},a={require:function(e){return y(e)},exports:function(e){var t=l[e];return void 0!==t?t:l[e]={}},module:function(e){return{id:e,uri:"",exports:l[e],config:function(e){return function(){return h&&h.config&&h.config[e]||{}}}(e)}}},o=function(e,t,i,o){var r,h,p,_,g,f,b=[],E=typeof i;if(o=o||e,"undefined"===E||"function"===E){for(t=!t.length&&i.length?["require","exports","module"]:t,g=0;g<t.length;g+=1)if("require"===(h=(_=s(t[g],o)).f))b[g]=a.require(e);else if("exports"===h)b[g]=a.exports(e),f=!0;else if("module"===h)r=b[g]=a.module(e);else if(d(l,h)||d(u,h)||d(c,h))b[g]=S(h);else{if(!_.p)throw new Error(e+" missing "+h);_.p.load(_.n,y(o,!0),m(h),{}),b[g]=l[h]}p=i?i.apply(l[e],b):void 0,e&&(r&&r.exports!==n&&r.exports!==l[e]?l[e]=r.exports:p===n&&f||(l[e]=p))}else e&&(l[e]=i)},e=t=r=function(e,t,i,l,u){if("string"==typeof e)return a[e]?a[e](t):S(s(e,t).f);if(!e.splice){if((h=e).deps&&r(h.deps,h.callback),!t)return;t.splice?(e=t,t=i,i=null):e=n}return t=t||function(){},"function"==typeof i&&(i=l,l=u),l?o(n,e,t,i):setTimeout(function(){o(n,e,t,i)},4),r},r.config=function(e){return r(e)},e._defined=l,(i=function(e,t,i){t.splice||(i=t,t=[]),d(l,e)||d(u,e)||(u[e]=[e,t,i])}).amd={jQuery:!0}}(),i("../build/libs/almond.js",function(){}),i("util/CommonTools",[],function(){return{_navigator:navigator,extend:function(e,t){for(var i in t)t.hasOwnProperty(i)&&("object"==typeof t[i]?e[i]=this.extend({},t[i]):e[i]=t[i]);return e},addEvent:function(e,t,i){/msie/i.test(this._navigator.userAgent)||/trident/i.test(this._navigator.userAgent)?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)},isDesktop:function(){for(var e=0;e<navigator.plugins.length;e++)if("application/x-ppapi-release"===navigator.plugins[e][0].type||"application/x-ppapi-debug"===navigator.plugins[e][0].type)return!0;return!1}}}),i("util/Log",[],function(){window.console||(window.console={log:function(){}});var e=function(t){return function(i,n,o){o||(o="debug"),e.Config.isLogToBeOutput(t,i,o)&&console.log("["+t+"."+i+"] "+n)}};return e.LOG_ERROR="error",e.LOG_WARN="warn",e.LOG_DEBUG="debug",e.LOG_INFO="info",e.Config={isLoggingToConsoleEnabled:!1,defaultValues:1,loggingLevels:{error:1,warn:1,debug:1,info:1},classLogging:{},methodLogging:{},_isLevelEnabled:function(e){return 1===this.defaultValues&&(1===this.loggingLevels[e]||void 0===this.loggingLevels[e])||0===this.defaultValues&&1===this.loggingLevels[e]},setEnableLogging:function(e){this.isLoggingToConsoleEnabled=e},setDefaultValues:function(e){this.defaultValues=e},setLoggingLevels:function(e){this.loggingLevels=e},setClassLogging:function(e){this.classLogging=e},setMethodLogging:function(e){this.methodLogging=e},configure:function(e){var t,i=null;for(i in e)if(e.hasOwnProperty(i)){if(!(t=this["set"+i.substr(0,1).toUpperCase()+i.substr(1)]))throw"Log.Config configure - no setter method for attribute "+i;t.call(this,e[i])}},isLogToBeOutput:function(e,t,i){if(this.isLoggingToConsoleEnabled&&this._isLevelEnabled(i))if(0===this.defaultValues){if(1===this.classLogging[e]&&0!==this.methodLogging[t]||1===this.methodLogging[t])return!0}else if(!(void 0!==this.classLogging[e]&&1!==this.classLogging[e]||void 0!==this.methodLogging[t]&&1!==this.methodLogging[t]))return!0;return!1}},e}),i("util/Observable",["util/Log"],function(e){return{_log:new e("Observable"),addEventListener:function(e,t){this._log("addEventListener","Adding listener for "+e+" event"),this._eventLookup||(this._eventLookup={}),this._eventLookup[e]||(this._eventLookup[e]=[]),this._eventLookup[e].push(t)},removeEventListener:function(e,t){this._log("removeEventListener","Removing listener for "+e+" event"),this._eventLookup&&this._eventLookup[e]&&(this._eventLookup[e]=this._eventLookup[e].filter(function(e){return e!==t}))},_fireEvent:function(e,t){this._log("_fireEvent","Firing "+e+" event"),this._eventLookup&&this._eventLookup[e]&&this._eventLookup[e].forEach(function(e){t&&t.length&&"string"!=typeof t?e.apply(null,t):e(t)})}}}),i("util/AsyncAgent",["util/CommonTools","util/Observable"],function(e,t){var i={_translateParameters:function(e){var t="cb",i=[],n=this;return this._cbIndex||0===this._cbIndex?this._cbIndex++:this._cbIndex=0,t+=this._cbIndex,this._callbackLookup||(this._callbackLookup={}),this._callbackLookup[t]=[],e.forEach(function(e){"function"==typeof e?(n._callbackLookup[t].push(e),i.push(t+0)):i.push(e)}),i},_resolveCallback:function(e){var t,i,n,o;for(t=0;t<e.length;t++)n=(i=e[t].ref).substr(0,i.length-1),o=i.substr(i.length-1,1),this._callbackLookup&&this._callbackLookup[n]&&this._callbackLookup[n][o]&&this._callbackLookup[n][o].apply(null,e[t].params),this._callbackLookup[n]=null,delete this._callbackLookup[n]},_triggerEvent:function(e){var t;for(t=0;t<e.length;t++)this._fireEvent(e[t].ref,e[t].params)},_updateProperties:function(e){var t,i;if(e)for(i=0;i<e.length;i++)if(e[i]&&e[i].params&&e[i].params[0])for(var n in t=e[i].params[0])this[n]=t[n]}};return e.extend(i,t),i}),i("MessageBroker",["util/Log"],function(e){return{_log:new e("MessageBroker"),_targets:{},_pluginInstance:null,_pluginType:null,_callOperationOnTarget:function(e,t,i){this._targets[e][t].call(this._targets[e],i[e])},_processMessageForOperation:function(e,t){var i,n=e[t];if(n)for(i in n)n.hasOwnProperty(i)&&this._targets[i]&&this._targets[i][t]&&this._callOperationOnTarget(i,t,n)},setPluginInstance:function(e){var t=this;this._pluginInstance=e,this._pluginInstance.addEventListener("message",function(e){t.receiveMessage(e.data)},!0)},registerTarget:function(e){this._log("registerTarget","Registering target with name "+e.getName()),this._targets[e.getName()]=e},createMessage:function(e,t,i,n){var o=t._translateParameters(n);return this._log("createMessage","Creating message with params target: "+e+", sender: "+t.getName()+", operation: "+i+", parameters: "+o),{target:e,sender:t.getName(),op:i,params:o}},sendMessage:function(e,t){if(this._log("sendMessage","Sending message "+JSON.stringify(e)),t)return this._pluginInstance.postMessageAndAwaitResponse(e);this._pluginInstance.postMessage(e)},receiveMessage:function(e){var t;for(t in this._log("receiveMessage","Message received "+JSON.stringify(e)),e._updateProperties&&this._processMessageForOperation(e,"_updateProperties"),delete e._updateProperties,e)e.hasOwnProperty(t)&&this._processMessageForOperation(e,t)}}}),i("DRMAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._messageBroker=i,this._messageBroker.registerTarget(this),this._deviceId="",this._deviceUniqueId="",this._state=this.TDRMState.STATE_INITIALIZATION_REQUIRED,this._initializationPayloadForServer="",this._serverPrivateData="",this._lastCommunicationStatus=this.TDRMCommuncationStatus.COMMUNICATION_UNKNOWN,this._licenseImportationState=this.TDRMLicenseImportationState.LICENSE_IMPORTATION_UNSTARTED,this._lastStorageError=this.TDRMStorageError.PAK_STORAGE_NO_ERROR,this._prefetchLicensesState=this.TDRMLicensePrefetchingState.LICENSE_PREFETCHING_UNSTARTED,this._sessions=[]}return n.prototype.initialize=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"initialize",[e]);this._messageBroker.sendMessage(t)},n.prototype.silentInitialize=function(e,t,i,n){var o;o=n?this._messageBroker.createMessage("drmAgent",this,"silentInitialize",[e,t,i,n]):this._messageBroker.createMessage("drmAgent",this,"silentInitialize",[e,t,i]),this._messageBroker.sendMessage(o)},n.prototype.silentInitializeWithPersistence=function(e,t,i,n){this.silentInitialize(e,t,i,n)},n.prototype.reset=function(){var e=this._messageBroker.createMessage("drmAgent",this,"reset",[]);this._messageBroker.sendMessage(e)},n.prototype.setEntitlement=function(e,t,i){var n=this._messageBroker.createMessage("drmAgent",this,"setEntitlement",[e,t,i]);this._messageBroker.sendMessage(n)},n.prototype.requestEntitlement=function(e,t,i,n){var o=["string"==typeof e?JSON.parse(e):e,t,i];n&&o.push(n);var r=this._messageBroker.createMessage("drmAgent",this,"requestEntitlement",o);return this._messageBroker.sendMessage(r,!0)},n.prototype.importLicenses=function(e,t){var i=this._messageBroker.createMessage("drmAgent",this,"importLicenses",[e,t]);this._messageBroker.sendMessage(i)},n.prototype.getPrefetchLicensesPayloadForServer=function(){var e=this._messageBroker.createMessage("drmAgent",this,"getPrefetchLicensesPayloadForServer",[]);return this._messageBroker.sendMessage(e,!0)},n.prototype.generateListOfStoredDrmEntitlements=function(e,t,i,n){var o=this._messageBroker.createMessage("drmAgent",this,"generateListOfStoredDrmEntitlements",[e,t,i,n]);return this._messageBroker.sendMessage(o,!0)},n.prototype.eraseStoredEntitlements=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"eraseStoredEntitlements",[e]);this._messageBroker.sendMessage(t)},n.prototype.prefetchLicenses=function(e,t,i,n){var o=this._messageBroker.createMessage("drmAgent",this,"prefetchLicenses",[e,t,i,n]);this._messageBroker.sendMessage(o)},n.prototype.getDrmSessions=function(){return this._sessions},n.prototype.setUserAgent=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"setUserAgent",[e]);this._messageBroker.sendMessage(t)},n.prototype.getName=function(){return"drmAgent"},Object.defineProperty(n.prototype,"deviceId",{get:function(){return this._deviceId},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"deviceUniqueId",{get:function(){return this._deviceUniqueId},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"initializationPayloadForServer",{get:function(){return this._initializationPayloadForServer},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"serverPrivateData",{get:function(){return this._serverPrivateData},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"lastCommunicationStatus",{get:function(){return this._lastCommunicationStatus},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"licenseImportationState",{get:function(){return this._licenseImportationState},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"lastStorageError",{get:function(){return this._lastStorageError},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"prefetchLicensesState",{get:function(){return this._prefetchLicensesState},enumerable:!0,configurable:!1}),n.prototype.TDRMState={STATE_READY:0,STATE_INITIALIZATION_REQUIRED:100,STATE_FATAL_ERROR:200,STATE_FATAL_ERROR_OPERATOR:201},n.prototype.TDRMAccess={ACCESS_GRANTED:0,ACCESS_DENIED:100,ACCESS_DENIED_EXPIRED_ENTITLEMENT:101,ACCESS_DENIED_INVALID_ENTITLEMENT:102,ACCESS_DENIED_RETRIEVING_LICENSE:103},n.prototype.TDRMSessionStatus={SESSION_ENTITLEMENT_MISSING:1,SESSION_RETRIEVING_LICENSE:5,SESSION_OPENED:10,SESSION_FAILED:100,SESSION_FAILED_NOT_ALLOWED:102},n.prototype.TDRMEntitlementState={ENTITLEMENT_MISSING:0,ENTITLEMENT_READY:1},n.prototype.TDRMLicenseImportationState={LICENSE_IMPORTATION_UNSTARTED:0,LICENSE_IMPORTATION_IN_PROGRESS:1,LICENSE_IMPORTATION_DONE:2},n.prototype.TDRMStorageError={PAK_STORAGE_NO_ERROR:0,PAK_STORAGE_ERROR_DATABASE_OR_DISK_FULL:1,PAK_STORAGE_NOT_ALLOWED:2,PAK_STORAGE_ERROR_DB_ERROR:3},n.prototype.TDRMLicensePrefetchingState={LICENSE_PREFETCHING_UNSTARTED:0,LICENSE_PREFETCHING_IN_PROGRESS:1,LICENSE_PREFETCHING_DONE:2,LICENSE_PREFETCHING_ERROR_COMMUNICATION_FAILED:100},n.prototype.TDRMCommuncationStatus={COMMUNICATION_OK:0,COMMUNICATION_UNKNOWN:100,COMMUNICATION_PLAYER_UPGRADE_REQUIRED:101,COMMUNICATION_ERROR_REQUEST_DENIED:200,COMMUNICATION_ERROR_URL:201,COMMUNICATION_ERROR_CONNECT:202,COMMUNICATION_ERROR_PROXY:203,COMMUNICATION_ERROR_HOST:204,COMMUNICATION_ERROR_HTTP:205,COMMUNICATION_ERROR_SEND:206,COMMUNICATION_ERROR_RECEIVE:207,COMMUNICATION_ERROR_TIMEOUT:208,COMMUNICATION_ERROR_INTERNAL:209,COMMUNICATION_STATUS_WHITEBOX_CRYPTO_ERROR:210,COMMUNICATION_STATUS_UNKNOWN_OPERATOR:211,COMMUNICATION_STATUS_REQUEST_FORMAT_ERROR:212,COMMUNICATION_STATUS_CHALLENGE_FORMAT_ERROR:213,COMMUNICATION_STATUS_UNDEFINED_DEVICE:214,COMMUNICATION_STATUS_INVALID_CONTENT_ID:215,COMMUNICATION_STATUS_INVALID_KEY_ID:216,COMMUNICATION_STATUS_PORTAL_ERROR:217},e.extend(n.prototype,t),n}),i("UserAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){var e=this;this._messageBroker=i,this._messageBroker.registerTarget(this),this._fullscreen=!1,this._platform="NaCl",this._version="NMP.1.9.3.1075428",this._interfaceVersion="",this._cpuCores=null,this._density=null,this._cpuFrequency=null,this._os=null,this._uninstallUrl="",window.parent.document.addEventListener("nmp.fetchDeviceInformation",function(t){var i=t&&t.detail?t.detail:{};for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])})}return Object.defineProperty(n.prototype,"fullscreen",{get:function(){return this._fullscreen},set:function(){},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"platform",{get:function(){return this._platform},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"interfaceVersion",{get:function(){return this._interfaceVersion},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"uninstallUrl",{get:function(){return this._uninstallUrl},set:function(e){this._uninstallUrl=e,this._log("uninstallUrl","Setting uninstallUrl to "+e);var t=document.createEvent("CustomEvent");t.initCustomEvent("nmp-extension-message",!0,!0,{action:"SetUninstallUrl",payload:e}),window.parent.document.dispatchEvent(t)},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"deviceInformation",{get:function(){return{device:{OS:{type:this._os,version:null,runtime:"NaCl"},CPU:{cores:this._cpuCores,frequency:this._cpuFrequency},GPU:{cores:null,frequency:null,model:null},hardware:{type:"Desktop",model:null,manufacturer:null},screen:{width:screen.width,height:screen.height,density:this._density}},securePlayer:{DRMs:["PRM"],streamings:["HLS"],codecs:["H264","AAC"]}}},enumerable:!0,configurable:!1}),n.prototype.getName=function(){return"userAgent"},e.extend(n.prototype,t),n}),i("VideoAgent",["util/CommonTools","util/AsyncAgent","MessageBroker","util/Log"],function(e,t,i,n){function o(e){return-1===e.indexOf("%")&&-1===e.toLowerCase().indexOf("px")&&(e+="px"),e}class r extends HTMLElement{constructor(){super();var e=this;this._log=new n("VideoAgent"),this._autoplay=!0,this._controls=!0,this._muted=!1,this._volume=1,this._resetProperties(),this._isPendingSetSource=!1,this._queuedSrc=null,this._messageBroker=i,this._messageBroker.registerTarget(this),this.MAXIMUM_SEEK_BACK_BOUNDARY=2147483647,this.addEventListener("error",function(){e._setPendingSetSource(!1)}),this._subtitleElem=document.createElement("div"),this.creationCompletion()}}function s(e){return{_timeRanges:e,start:function(e){return this._timeRanges&&this._timeRanges[e]?this._timeRanges[e].start:0},end:function(e){return this._timeRanges&&this._timeRanges[e]?this._timeRanges[e].end:0},length:e.length||0}}return r.prototype=Object.create(HTMLElement.prototype),e.extend(r.prototype,t),r.prototype._resetProperties=function(){this._src="",this._currentTime=0,this._paused=!0,this._duration=0,this._ended=!1,this._seeking=!1,this._readyState=this.HAVE_NOTHING,this._networkState=this.NETWORK_EMPTY,this._seekable=s([]),this._error=null,this._videoWidth=0,this._videoHeight=0,this._maximumSeekBack=0,this._disableSeek=!1},r.prototype._setPendingSetSource=function(e){this._isPendingSetSource=e,!this._isPendingSetSource&&this._queuedSrc&&(this.src=this._queuedSrc,this._queuedSrc=null)},Object.defineProperty(r.prototype,"src",{get:function(){return this._src},set:function(e){if(this._log("src","Setting src to "+e),this._isPendingSetSource)this._queuedSrc=e;else{this._resetProperties(),this._queuedSrc=null;var t=this._messageBroker.createMessage("videoAgent",this,"setSrc",[e]);this._messageBroker.sendMessage(t),this._setPendingSetSource(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._log("autoplay","Setting autoplay to "+e),this._autoplay=e;var t=this._messageBroker.createMessage("videoAgent",this,"setAutoplay",[this._autoplay]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentSrc",{get:function(){return this._src}}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._currentTime},set:function(e){if(this._log("currentTime","Setting currentTime to "+e),4294967296!==this._duration||!this._disableSeek){var t=this._messageBroker.createMessage("videoAgent",this,"setCurrentTime",[e]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ended",{get:function(){return this._ended},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"seeking",{get:function(){return this._seeking},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"seekable",{get:function(){return this._seekable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"readyState",{get:function(){return this._readyState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"HAVE_NOTHING",{get:function(){return 0},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"HAVE_METADATA",{get:function(){return 1},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"HAVE_CURRENT_DATA",{get:function(){return 2},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"HAVE_FUTURE_DATA",{get:function(){return 3},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"HAVE_ENOUGH_DATA",{get:function(){return 4},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"networkState",{get:function(){return this._networkState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"NETWORK_EMPTY",{get:function(){return 0},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"NETWORK_IDLE",{get:function(){return 1},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"NETWORK_LOADING",{get:function(){return 2},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"NETWORK_NO_SOURCE",{get:function(){return 3},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"error",{get:function(){return this._error?{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4,code:this._error}:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"controls",{get:function(){return this._controls},set:function(e){this._log("controls","Setting controls to "+e),this._controls=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"volume",{get:function(){return this._volume},set:function(e){if(this._log("volume","Setting volume to "+e),((e=parseFloat(e))||0===e)&&e>=0&&e<=1){var t=this._messageBroker.createMessage("videoAgent",this,"setVolume",[e]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"muted",{get:function(){return this._muted},set:function(e){this._log("muted","Setting muted to "+e);var t=this._messageBroker.createMessage("videoAgent",this,"setMuted",[e]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"videoWidth",{get:function(){return this._videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"videoHeight",{get:function(){return this._videoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return parseInt(window.getComputedStyle(this,null).getPropertyValue("width"),10)},set:function(e){e+="",this.setAttribute("width",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return parseInt(window.getComputedStyle(this,null).getPropertyValue("height"),10)},set:function(e){e+="",this.setAttribute("height",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maximumSeekBack",{get:function(){return this._maximumSeekBack},set:function(e){if(this._log("maximumSeekBack","Setting maximumSeekBack to "+e),((e=parseInt(e,10))||0===e)&&e<=this.MAXIMUM_SEEK_BACK_BOUNDARY){this._maximumSeekBack=e;var t=this._messageBroker.createMessage("videoAgent",this,"setMaximumSeekBack",[this._maximumSeekBack]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"disableSeek",{get:function(){return this._disableSeek},set:function(e){this._log("disableSeek","Setting disableSeek to "+e),this._disableSeek=!0===e||"true"===e;var t=this._messageBroker.createMessage("videoAgent",this,"setDisableSeek",[this._disableSeek]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),r.prototype.pause=function(){this._log("pause","");var e=this._messageBroker.createMessage("videoAgent",this,"pause",[]);this._messageBroker.sendMessage(e)},r.prototype.play=function(){this._log("play","");var e=this._messageBroker.createMessage("videoAgent",this,"play",[]);this._messageBroker.sendMessage(e)},r.prototype.load=function(){this._log("load","");var e=this._messageBroker.createMessage("videoAgent",this,"load",[]);this._messageBroker.sendMessage(e)},r.prototype.stop=function(){this._log("stop","");var e=this._messageBroker.createMessage("videoAgent",this,"stop",[]);this._messageBroker.sendMessage(e)},r.prototype._updateProperties=function(e){var i,n;if(e){for(n=0;n<e.length;n++)e[n]&&e[n].params&&e[n].params[0]&&(i=e[n].params[0])._seekable&&(this._seekable=s(i._seekable),delete e[n].params[0]._seekable);t._updateProperties.call(this,e)}},r.prototype.getName=function(){return"videoAgent"},customElements.define&&(r.prototype._createEmbedElement=function(e){this.embedElem=document.createElement("embed"),this.embedElem.style.position="absolute",this.embedElem.setAttribute("id","__nmpcbrowserplugin"),this.embedElem.style.left="0px",this.embedElem.style.top="0px",this.embedElem.style.width="100%",this.embedElem.style.height="100%",this.embedElem.setAttribute("data-nmp-resourcepath",this.getAttribute("data-nmp-resourcepath")||"testData/"),this.embedElem.setAttribute("type",this.getAttribute("type")||"application/x-nacl"),this.embedElem.setAttribute("src",this.getAttribute("data-nmp-src")),this.embedElem.setAttribute("onload","__NMPPluginLoaded(this)"),e&&this._subtitleElem&&this._subtitleElem.parentNode.insertBefore(this.embedElem,this._subtitleElem)},r.prototype.attributeChangedCallback=function(e,t,i){"width"!==e&&"height"!==e||(i+="",this.style[e]=o(i)),"src"===e&&(this.src=i)},r.prototype.detachedCallback=function(){this.embedElem.parentNode.removeChild(this.embedElem),this._createEmbedElement(!0)},r.prototype.creationCompletion=function(){var t=this,i=this.getAttribute("width");i&&(this.style.width=o(i));var n=this.getAttribute("height");n&&(this.style.height=o(n));var r=this.attachShadow({mode:"open"}),s=document.createElement("style");s.innerHTML=":host {background-color: black; display: block; margin:auto; padding: 0; position: relative; width: 427px; height: 240px}.white {color: white} .green{color: green} .blue{color: blue} .cyan{color: cyan} .red{color: red} .yellow{color: yellow} .magenta{color: magenta} .black{color: black}.bg_white {background-color: white} .bg_green{background-color: green} .bg_blue{background-color: blue} .bg_cyan{background-color: cyan} .bg_red{background-color: red}.bg_yellow{background-color: yellow} .bg_magenta{background-color: magenta}.transparent{opacity: 0} .semi-transparent{opacity: 0.5} .opaque{opacity: 1}.underline{text-decoration: underline} .italics{font-style: italic} .blink{-webkit-animation: blink 1s steps(1, start) infinite}@-webkit-keyframes blink {0% { opacity: 1.0; } 50% { opacity: 0.0; } 100% { opacity: 1.0; }}.mono_serif {font-family:'Courier New', monospace, serif;} .prop_serif{font-family:'Times Roman', serif;} .mono_sans{font-family:'Arial Monospaced', monospace, sans-serif;}.prop_sans{font-family:'Century Gothic', sans-serif;} .casual{ font-family:'Lucinda Casual', 'Dom Casual';} .cursive{font-family: cursive;} .small_caps{font-variant: small-caps;}.outline_white {text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;} .outline_green{text-shadow: -1px -1px 0 green, 1px -1px 0 green, -1px 1px 0 green, 1px 1px 0 green;} .outline_blue{text-shadow: -1px -1px 0 blue, 1px -1px 0 blue, -1px 1px 0 blue, 1px 1px 0 blue;} .outline_cyan{text-shadow: -1px -1px 0 cyan, 1px -1px 0 cyan, -1px 1px 0 cyan, 1px 1px 0 cyan;} .outline_red{text-shadow: -1px -1px 0 red, 1px -1px 0 red, -1px 1px 0 red, 1px 1px 0 red;} .outline_yellow{text-shadow: -1px -1px 0 yellow, 1px -1px 0 yellow, -1px 1px 0 yellow, 1px 1px 0 yellow;} .outline_magenta{text-shadow: -1px -1px 0 magenta, 1px -1px 0 magenta, -1px 1px 0 magenta, 1px 1px 0 magenta;} .outline_black{text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black;}",r.appendChild(s),this._createEmbedElement(!1),this._subtitleElem=document.createElement("div"),this._subtitleElem.style.position="absolute",this._subtitleElem.style.webkitTransform="translate3d(0px, 0px, 0px)",this._subtitleElem.style.width="100%",this._subtitleElem.style.height="100%",this._subtitleElem.style.overflow="hidden",this._subtitleElem.style.tabSize=4,this._subtitleElem.style.lineHeight="130%",this._subtitleElem.style.color="rgb(255,255,255)",navigator.webkitPersistentStorage.requestQuota(67108864,function(i){i>0?(r.appendChild(t.embedElem),r.appendChild(t._subtitleElem),e.isDesktop()&&__NMPPluginLoaded(t.embedElem)):t.onerror&&"function"==typeof t.onerror&&t.onerror()},function(){t.onerror&&"function"==typeof t.onerror&&t.onerror()})},customElements.define("nmp-video",r)),r}),i("NetworkAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._messageBroker=i,this._messageBroker.registerTarget(this),this._error=null,this._availableBitrates=[],this._selectedBitrate=null,this._contentServerUrl=null,this._contentServerFinalUrl=null,this._contentServerFinalIPAddress=null,this._downloadBitrate=0,this._downloadBitrateAverage=0,this._bytesDownloaded=0,this._httpErrorCode=null,this._httpErrorMessage=null}return n.prototype.getName=function(){return"networkAgent"},Object.defineProperty(n.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"adaptiveStreaming",{get:function(){return{availableBitrates:this._availableBitrates,selectedBitrate:this._selectedBitrate?this._selectedBitrate:null}},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"contentServer",{get:function(){return{url:this._contentServerUrl?this._contentServerUrl:null,finalUrl:this._contentServerFinalUrl?this._contentServerFinalUrl:null,finalIpAddress:this._contentServerFinalIPAddress?this._contentServerFinalIPAddress:null}},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"usage",{get:function(){var e=this._messageBroker.createMessage("networkAgent",this,"getNetworkUsage",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"httpErrorCode",{get:function(){return this._httpErrorCode=this._httpErrorCode?this._httpErrorCode:null,this._httpErrorCode},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"httpErrorMessage",{get:function(){return this._httpErrorMessage=this._httpErrorMessage?this._httpErrorMessage:null,this._httpErrorMessage},enumerable:!0,configurable:!1}),n.prototype.TNetworkError={NETWORK_HOST_CONNECTION_REFUSED:1,NETWORK_HOST_CONNECTION_CLOSED:2,NETWORK_HOST_NOT_FOUND:3,NETWORK_HOST_TIMEOUT:4,NETWORK_PROXY_CONNECTION_REFUSED:101,NETWORK_PROXY_CONNECTION_CLOSED:102,NETWORK_PROXY_NOT_FOUND:103,NETWORK_PROXY_TIMEOUT:104,NETWORK_PROXY_AUTHENTICATION_REQUIRED:105,NETWORK_CONTENT_HTTP_ERROR:400,NETWORK_UNKNOWN_ERROR:1001},e.extend(n.prototype,t),n}),i("libs/fittext",[],function(){window.fitText=function(e,t,i){var n=function(e,t){for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key]);return e}({minFontSize:-1/0,maxFontSize:1/0},i),o=function(e){var i=t||1,o=function(){e.style.fontSize=Math.max(Math.min(e.clientWidth/(10*i),parseFloat(n.maxFontSize)),parseFloat(n.minFontSize))+"px"};o(),function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}(window,"resize",o)};if(e.length)for(var r=0;r<e.length;r++)o(e[r]);else o(e);return e}}),i("util/Timer",[],function(){function e(e){this._timeRemaining=0,this._expiredCallback=e,this._startTime=0,this._timeout=null}return e.prototype.setDuration=function(e,t){this._timeRemaining=e,t&&(this.cancel(),this.start())},e.prototype.start=function(){var e=this;this._timeout||(this._startTime=new Date,this._timeout=window.setTimeout(function(){e._expiredCallback()},this._timeRemaining))},e.prototype.stop=function(){this.cancel(),this._timeRemaining-=new Date-this._startTime},e.prototype.cancel=function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)},e}),i("WebVTTSubtitleRenderer",["libs/fittext","util/Timer"],function(e,t){function i(){var e=this;this._vttCues=[],this._mainSubtitleDiv=null,this._displayedVTTCue=null,this._textSpanBGColor=null,this._textSpanBGOpacity=null,this._fontColor=null,this._fontOpacity=null,this._edgeAttribute=null,this._edgeRGB=null,this._containerStyles=[],this._FITTEXT_OFFSET=2.1,this.fittextRatio=.02,this._MAX_FONTSIZE=200,this._fittextCompressRate=null,this._createFontStyleLookup(),this._styleElement=null,this._divHeight=0,this._divWidth=0,this._SAFE_MARGIN_PERCENT=10,this._DEFAULT_LINE_PERCENTAGE=80,this._isSubtitlesActivated=!1,this._clearScreenTimer=new t(function(){e.clearScreen()}),this._regions={},this._videoWidth=0,this._videoHeight=0}return i.prototype.onPause=function(){for(var e in this._clearScreenTimer&&this._clearScreenTimer.stop(),this._regions)this._regions.hasOwnProperty(e)&&"block"===this._regions[e].container.style.display&&this._regions[e].timer.stop()},i.prototype.onPlay=function(){for(var e in this._displayedVTTCue&&this._clearScreenTimer.start(),this._regions)this._regions.hasOwnProperty(e)&&"block"===this._regions[e].container.style.display&&this._regions[e].timer.start()},i.prototype._createFontStyleLookup=function(){this._fontStyleLookup={},this._fontStyleLookup[1]={className:".mono_serif",defaultFont:" monospace, serif"},this._fontStyleLookup[2]={className:".prop_serif",defaultFont:" serif"},this._fontStyleLookup[3]={className:".mono_sans",defaultFont:" monospace, sans-serif"},this._fontStyleLookup[4]={className:".prop_sans",defaultFont:" sans-serif"},this._fontStyleLookup[5]={className:".casual",defaultFont:""},this._fontStyleLookup[6]={className:".cursive",defaultFont:" cursive"},this._fontStyleLookup[7]={className:".small_caps",defaultFont:" small-caps"}},i.prototype._addBackground=function(e){for(var t,i,n,o,r=e.childNodes,s=0;s<r.length;s++)i=r[s],n=null!==this._textSpanBGColor?this._textSpanBGColor:"0,0,0",o=null!==this._textSpanBGOpacity?this._textSpanBGOpacity:"1","\n"!==i.textContent.trim()&&""!==i.textContent.trim()&&(null===i.nodeValue?i.style&&""===i.style.backgroundColor?-1===i.className.indexOf("transparent")?(n=this._getRGBColorForComputedStyle(window.getComputedStyle(i,null).getPropertyValue("background-color")),n=null!==this._textSpanBGColor?this._textSpanBGColor:n,i.style.backgroundColor="rgba("+n+","+o+")"):((t=document.createElement("span")).style.backgroundColor="rgba("+n+","+o+")",i.parentNode.insertBefore(t,i),t.appendChild(i)):(-1!==i.style.backgroundColor.indexOf("rgba")?(o=this._getOpacityForRGBAString(i.style.backgroundColor),n=this._getRGBValueForRGBAString(i.style.backgroundColor)):-1!==i.style.backgroundColor.indexOf("rgb")?(o=1,n=this._getRGBValueForString(i.style.backgroundColor,"rgb(")):(o=1,n=this._getRGBColorForComputedStyle(window.getComputedStyle(i,null).getPropertyValue("background-color"))),n=null!==this._textSpanBGColor?this._textSpanBGColor:n,o=null!==this._textSpanBGOpacity?this._textSpanBGOpacity:o,i.style.backgroundColor="rgba("+n+","+o+")"):((t=document.createElement("span")).style.backgroundColor="rgba("+n+","+o+")",t.innerHTML=i.nodeValue,i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i)))},i.prototype._getRGBValueForRGBAString=function(e){var t=e.indexOf("rgba("),i=e.lastIndexOf(",");return e.substring(t+5,i)},i.prototype._getOpacityForRGBAString=function(e){var t=e.lastIndexOf(","),i=e.indexOf(")",t);return e.substring(t+1,i)},i.prototype._getRGBValueForString=function(e,t){var i=e.indexOf(t),n=e.indexOf(")",i);return e.substring(i+t.length,n)},i.prototype._applyNodeStyles=function(e){var t,i,n,o,r=e.getElementsByTagName("*"),s=1;0===r.length&&(r=[e]);for(var a=0;a<r.length;a++)i=null,o=(t=r[a]).className,this._applyNodeColorStyles(t),o.indexOf("bg_rgb(")>-1&&(i="rgb("+this._getRGBValueForString(o,"bg_rgb(")+")",t.style.backgroundColor=i),(o.indexOf("bg_semi-transparent")>-1||o.indexOf("bg_transparent")>-1||o.indexOf("bg_opaque")>-1)&&(i||(i=window.getComputedStyle(t,null).getPropertyValue("background-color")),s=o.indexOf("bg_semi-transparent")>-1?.5:o.indexOf("bg_transparent")>-1?0:1,i.indexOf("rgba")>-1&&(i=i.substr(0,i.lastIndexOf(",")).replace("rgba","rgb")+")"),t.style.backgroundColor=i.replace("rgb","rgba").replace(")",", "+s+")")),(o.indexOf("small")>-1||o.indexOf("large")>-1)&&(n=parseInt(window.getComputedStyle(t,null).getPropertyValue("font-size"),10),o.indexOf("small")>-1?(t.style.verticalAlign="top",t.style.fontSize=.8*n+"px"):t.style.fontSize=1.2*n+"px"),this._updateForEdgeStyles(t)},i.prototype._getOpacityForComputedStyle=function(e){return-1!==e.indexOf("rgba(")?this._getOpacityForRGBAString(e):"1"},i.prototype._getRGBColorForComputedStyle=function(e){return-1!==e.indexOf("rgba(")?this._getRGBValueForRGBAString(e):-1!==e.indexOf("rgb(")?this._getRGBValueForString(e,"rgb("):void 0},i.prototype._applyNodeColorStyles=function(e){var t,i,n;this._fontColor&&(this._fontOpacity||0===this._fontOpacity)?e.style.color="rgba("+this._fontColor+","+this._fontOpacity+")":e.className.indexOf("color_rgb(")>-1&&(e.style.color="rgb("+this._getRGBValueForString(e.className,"color_rgb(")+")"),this._fontColor||!this._fontOpacity&&0!==this._fontOpacity?this._fontColor&&!this._fontOpacity&&0!==this._fontOpacity&&(t=window.getComputedStyle(e,null).getPropertyValue("color"),i=this._getOpacityForComputedStyle(t),e.style.color="rgba("+this._fontColor+","+i+")"):(t=window.getComputedStyle(e,null).getPropertyValue("color"),n=this._getRGBColorForComputedStyle(t),e.style.color="rgba("+n+","+this._fontOpacity+")")},i.prototype._getTextShadowStyleForEdge=function(e,t){switch(e){case"NONE":return"";case"RAISED":return"-1px -1px 0px "+t;case"DEPRESSED":return"2px 1px 0px "+t;case"UNIFORM":return"-1px -1px 0px "+t+", 1px -1px 0px "+t+", -1px 1px 0px "+t+", 1px 1px 0px "+t;case"SHADOW":case"LEFT_SHADOW":return"-2px 2px 2px "+t;case"RIGHT_SHADOW":return"2px 2px 2px "+t;default:return""}},i.prototype._updateForEdgeStyles=function(e){var t=e.className,i="#000000";this._edgeAttribute||t.indexOf("raised")>-1||t.indexOf("depressed")>-1||t.indexOf("uniform")>-1||t.indexOf("left_drop_shadow")>-1||t.indexOf("right_drop_shadow")>-1?(this._edgeRGB?i="rgb("+this._edgeRGB+")":t.indexOf("outline_rgb")>-1?i="rgb("+this._getRGBValueForString(t,"outline_rgb(")+")":t.indexOf("outline_")>-1&&(i=t.substring(t.indexOf("outline_")+"outline_".length,t.length)),this._edgeAttribute?e.style.textShadow=this._getTextShadowStyleForEdge(this._edgeAttribute,i):t.indexOf("raised")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("RAISED",i):t.indexOf("depressed")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("DEPRESSED",i):t.indexOf("uniform")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("UNIFORM",i):t.indexOf("left_drop_shadow")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("LEFT_SHADOW",i):t.indexOf("right_drop_shadow")>-1&&(e.style.textShadow=this._getTextShadowStyleForEdge("RIGHT_SHADOW",i))):t.indexOf("outline_rgb")>-1?(i="rgb("+this._getRGBValueForString(t,"outline_rgb(")+")",e.style.textShadow="-1px -1px 0 "+i+", 1px -1px 0 "+i+", -1px 1px 0 "+i+", 1px 1px 0 "+i):e.style.textShadow=""},i.prototype._getAspectRatio=function(e,t){return e/t},i.prototype._repositionIfOverflowVideo=function(e){var t,i=this._mainSubtitleDiv.getBoundingClientRect(),n=i.top+i.height/100*90;e?(e.spanContainer.getBoundingClientRect(),(t=e.container.getBoundingClientRect()).bottom>n&&(e.container.style.top=n-i.top-t.height+"px")):(t=this._container.getBoundingClientRect()).bottom>n&&(this._container.style.top=n-i.top-t.height+"px")},i.prototype._positionMainDiv=function(){var e,t=this._getAspectRatio(this._videoWidth,this._videoHeight),i=this._outerSubtitleDiv.getBoundingClientRect(),n=this._getAspectRatio(i.width,i.height);n<t?(e=(i.height-i.width/t)/2,this._mainSubtitleDiv.style.top=e+"px",this._mainSubtitleDiv.style.left="0px",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height=i.height-2*e+"px"):n>t?(e=(i.width-i.height*t)/2,this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left=e+"px",this._mainSubtitleDiv.style.width=i.width-2*e+"px",this._mainSubtitleDiv.style.height="100%"):(this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left="0px")},i.prototype._showCue=function(e,t){var i,n=e.getCueAsHTML(),o=null;if(this._mainSubtitleDiv&&this._isSubtitlesActivated){if(i="start"===e.lineAlign?"left":"end"===e.lineAlign?"right":"middle"===e.lineAlign?"center":e.lineAlign||"left",null===e.region||void 0===e.region||-1===e.region){this._container=document.createElement("div"),this._textSpanContainer=document.createElement("div"),this._textSpan=document.createElement("span"),this._displayedVTTCue=e,this._textSpanContainer.style.position="relative",this._textSpanContainer.style.display="inline-block",this._textSpanContainer.style.width=e.size?e.size+"%":"100%";for(var r=0;r<this._containerStyles.length;r++)this._container.style[this._containerStyles[r].style]=this._containerStyles[r].value;this._container.style.textAlign=i,this._container.style.right="",this._container.style.left="","right"===i?this._container.style.right=100-e.position+"%":this._container.style.left=e.position+"%",this._container.style.top="auto"===e.line||-1===e.line?this._DEFAULT_LINE_PERCENTAGE+"%":e.line-1+"%",this._container.style.margin=0,this._container.style.padding=0,this._container.style.position="absolute",this._container.style.whiteSpace="pre-wrap",this._applyNodeColorStyles(this._container),this._textSpanContainer.appendChild(this._textSpan),this._container.appendChild(this._textSpanContainer),this._mainSubtitleDiv.appendChild(this._container);var s=this._textSpan;t&&this._clearScreenTimer.setDuration(1e3*(e.endTime-e.startTime),!0)}else{(o=this._regions[e.region]).vttCue=e,t&&(o.container.parentNode.appendChild(o.container),o.timer&&o.timer.cancel(),o.timer.setDuration(1e3*(e.endTime-e.startTime),!0));for(r=0;r<this._containerStyles.length;r++)o.container.style[this._containerStyles[r].style]=this._containerStyles[r].value;o.container.style.top=o.regionObj.top+"%",o.spanContainer.style.top="0px",o.spanContainer.style.textAlign=i,o.container.style.display="block",s=o.span}s.innerHTML="",s.appendChild(n),this._applyNodeStyles(s),this._addBackground(s),fitText(this._mainSubtitleDiv,this._fittextCompressRate),this._container&&(this._container.style.padding="0.25em 0.5em"),this._repositionIfOverflowVideo(o)}},i.prototype.clearScreen=function(){for(var e in this._container&&this._container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._container),this._displayedVTTCue=null,this._clearScreenTimer.cancel(),this._regions)this._regions.hasOwnProperty(e)&&this._hideRegion(e)},i.prototype._hideRegion=function(e){var t;if(this._regions[e]){for(t=this._regions[e];t.span.firstChild;)t.span.removeChild(t.span.firstChild);t.timer&&t.timer.cancel(),this._regions[e].container.style.display="none"}},i.prototype.setMainSubtitleDiv=function(e){this._outerSubtitleDiv=e,this._styleElement=document.createElement("style"),this._outerSubtitleDiv&&(this._mainSubtitleDiv=document.createElement("div"),this._mainSubtitleDiv.style.position="absolute",this._mainSubtitleDiv.style.lineHeight="initial",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.overflow="hidden",this._mainSubtitleDiv.style.tabSize=4,this._mainSubtitleDiv.appendChild(this._styleElement),this._outerSubtitleDiv.appendChild(this._mainSubtitleDiv),this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth)},i.prototype._webVTTJsonToVTTCue=function(e){var t=new VTTCue(e.startTime,e.endTime,e.text),i=e.position;return i||(i=this._SAFE_MARGIN_PERCENT),t.lineAlign=e.align,t.size=e.size,t.position=i,t.line=Math.ceil(e.line),t.region=e.regionId,t},i.prototype._createRegion=function(e){var i,n,o,r=this;if(this._mainSubtitleDiv){this._regions[e.id]&&this._regions[e.id].container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._regions[e.id].container),i=document.createElement("div"),n=document.createElement("div"),o=document.createElement("span"),n.style.position="relative",n.style.display="inline-block";for(var s=0;s<this._containerStyles.length;s++)i.style[this._containerStyles[s].style]=this._containerStyles[s].value;i.style.margin=0,i.style.width=e.width+"%",i.style.padding=0,i.style.position="absolute",i.style.whiteSpace="pre-wrap",n.style.backgroundColor=e.color,i.style.zIndex=e.layer,i.style.left=e.left+"%",n.style.height=e.height+"%",i.style.top=e.top+"%",i.style.display="none",i.style.right=this._SAFE_MARGIN_PERCENT+"%",i.style.textAlign="left",n.appendChild(o),i.appendChild(n),this._mainSubtitleDiv.appendChild(i),this._regions[e.id]={regionObj:e,container:i,spanContainer:n,span:o,timer:new t(function(){r._hideRegion(e.id)})}}},i.prototype.onWebVTTSubtitleChanged=function(e,t){t&&this._createRegion(t),e&&(e.size=e.size>100?100:e.size,null===e.regionId||void 0===e.regionId||-1===e.regionId?this.clearScreen():this._hideRegion(e.regionId),e.text&&""!==e&&this._showCue(this._webVTTJsonToVTTCue(e),!0))},i.prototype._didDivChangeSize=function(){return!!(this._mainSubtitleDiv&&this._divHeight!==this._outerSubtitleDiv.clientHeight||this._divWidth!==this._outerSubtitleDiv.clientWidth)},i.prototype._clearAllRegions=function(){for(var e in this._regions)this._regions.hasOwnProperty(e)&&this._regions[e].container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._regions[e].container);this._regions={}},i.prototype._subtitlesActivated=function(){this._isSubtitlesActivated=!0,this.clearScreen(),this._clearAllRegions(),this._vttCues=[]},i.prototype._subtitlesDeactivated=function(){this._isSubtitlesActivated=!1,this.clearScreen(),this._clearAllRegions(),this._vttCues=[]},i.prototype._redraw=function(){var e=this._displayedVTTCue;for(var t in e&&(this.clearScreen(),this._showCue(e,!1)),this._regions)this._regions.hasOwnProperty(t)&&"block"===this._regions[t].container.style.display&&this._showCue(this._regions[t].vttCue,!1)},i.prototype.onViewDidChange=function(){this._mainSubtitleDiv&&this._didDivChangeSize()&&(this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth,this._positionMainDiv(),this._redraw())},i.prototype._didVideoAspectChange=function(e,t){return!this._videoWidth||!this._videoHeight||this._getAspectRatio(e,t)!==this._getAspectRatio(this._videoWidth,this._videoHeight)},i.prototype.onVideoSizeChanged=function(e,t){this._mainSubtitleDiv&&this._didVideoAspectChange(e,t)&&(this._videoWidth=e,this._videoHeight=t,this._positionMainDiv(),this._redraw())},i.prototype.onCCSettingsChanged=function(e){var t="",i="";if(this._containerStyles=[{style:"backgroundColor",value:e.captionWindowColor}],this._textSpanBGColor=e.captionBackgroundColor,this._textSpanBGOpacity=e.captionBackgroundOpacity,this._fontColor=e.fontColor,this._fontOpacity=e.fontOpacity,this._edgeAttribute=e.edgeAttribute,this._edgeRGB=e.edgeRGB,e.fontSize>100?this.fittextRatio=.02:e.fontSize<=50?this.fittextRatio=.063:e.fontSize<=60?this.fittextRatio=.05:e.fontSize<=70?this.fittextRatio=.035:e.fontSize<=80?this.fittextRatio=.03:e.fontSize<90?this.fittextRatio=.027:e.fontSize<=100&&(this.fittextRatio=.022),this._fittextCompressRate=Math.round(100*((this._MAX_FONTSIZE-e.fontSize)*this.fittextRatio+this._FITTEXT_OFFSET))/100,this._mainSubtitleDiv&&this._styleElement&&(e.textStroke?this._mainSubtitleDiv.style.webkitTextStroke=e.textStroke:this._mainSubtitleDiv.style.webkitTextStroke=null,e.fonts.length>0)){for(var n=0;n<e.fonts.length;n++)0===e.fonts[n].style?this._mainSubtitleDiv.style.fontFamily=e.fonts[n].name:(i=""!==e.fonts[n].name?",":"",t+=this._fontStyleLookup[e.fonts[n].style].className+"{font-family:"+e.fonts[n].name+i+this._fontStyleLookup[e.fonts[n].style].defaultFont+" !important;} ");this._styleElement.innerHTML=t}this._mainSubtitleDiv&&this._redraw()},i}),i("SMPTESubtitleRenderer",["util/Timer"],function(e){function t(){var t=this;this._mainSubtitleDiv=null,this._outerSubtitleDiv=null,this._videoWidth=0,this._videoHeight=0,this._divWidth=0,this._divHeight=0,this._displayedSMPTEJson=null,this._regionDivLookup={},this._cellResolutionRows=15,this._clearScreenTimer=new e(function(){t.clearScreen()})}return t.prototype.setMainSubtitleDiv=function(e){e&&(this._outerSubtitleDiv=e,this._styleElement=document.createElement("style"),this._mainSubtitleDiv=document.createElement("div"),this._mainSubtitleDiv.style.position="absolute",this._mainSubtitleDiv.style.lineHeight="initial",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.overflow="hidden",this._mainSubtitleDiv.style.tabSize=4,this._mainSubtitleDiv.style.margin=0,this._mainSubtitleDiv.style.whiteSpace="pre-wrap",this._styleElement.innerHTML="p {margin: 0; background-color: black; display:inline-block}",this._outerSubtitleDiv.appendChild(this._styleElement),this._outerSubtitleDiv.appendChild(this._mainSubtitleDiv),this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth)},t.prototype._getLongData=function(e,t){return(((e.charCodeAt(t)<<8)+e.charCodeAt(t+1)<<8)+e.charCodeAt(t+2)<<8)+e.charCodeAt(t+3)},t.prototype.onPause=function(){this._clearScreenTimer&&this._clearScreenTimer.stop()},t.prototype.onPlay=function(){this._displayedSMPTEJson&&this._clearScreenTimer.start()},t.prototype._getAspectRatio=function(e,t){return e/t},t.prototype._repositionIfOverflowVideo=function(e){var t=this._mainSubtitleDiv.getBoundingClientRect(),i=e.getBoundingClientRect(),n=t.bottom;i.bottom>n&&(e.style.top=n-t.top-i.height+"px")},t.prototype._positionMainDiv=function(){var e,t=this._getAspectRatio(this._videoWidth,this._videoHeight),i=this._outerSubtitleDiv.getBoundingClientRect(),n=this._getAspectRatio(i.width,i.height);n<t?(e=(i.height-i.width/t)/2,this._mainSubtitleDiv.style.top=e+"px",this._mainSubtitleDiv.style.left="0px",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height=i.height-2*e+"px"):n>t?(e=(i.width-i.height*t)/2,this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left=e+"px",this._mainSubtitleDiv.style.width=i.width-2*e+"px",this._mainSubtitleDiv.style.height="100%"):(this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left="0px")},t.prototype._didVideoAspectChange=function(e,t){return!this._videoWidth||!this._videoHeight||this._getAspectRatio(e,t)!==this._getAspectRatio(this._videoWidth,this._videoHeight)},t.prototype.onVideoSizeChanged=function(e,t){this._mainSubtitleDiv&&this._didVideoAspectChange(e,t)&&(this._videoWidth=e,this._videoHeight=t,this._positionMainDiv(),this._redraw())},t.prototype.clearScreen=function(){this._mainSubtitleDiv&&(this._mainSubtitleDiv.innerHTML=""),this._clearScreenTimer.cancel(),this._displayedSMPTEJson=null},t.prototype._redraw=function(){this._displayedSMPTEJson&&this.onSMPTESubtitleChanged(this._displayedSMPTEJson,!0)},t.prototype._didDivChangeSize=function(){return!!(this._mainSubtitleDiv&&this._divHeight!==this._outerSubtitleDiv.clientHeight||this._divWidth!==this._outerSubtitleDiv.clientWidth)},t.prototype.onViewDidChange=function(){this._mainSubtitleDiv&&this._didDivChangeSize()&&(this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth,this._positionMainDiv(),this._redraw())},t.prototype._addSpacesToEmptyPTags=function(e){var t,i=e.getElementsByTagName("p");for(t=0;t<i.length;t++)""===i[t].innerHTML&&(i[t].innerHTML="&nbsp;",i[t].style.backgroundColor="transparent")},t.prototype._addLineBreaksToPTags=function(e){var t,i,n=e.getElementsByTagName("p");for(t=0;t<n.length;t++)i=document.createElement("br"),n[t].parentNode.insertBefore(i,n[t].nextSibling)},t.prototype._createImgTagsFromMetadata=function(e){var t,i,n,o,r,s,a,l=e.getElementsByTagName("metadata"),u=0,h=0;for(u=l.length-1;u>=0;u--){for(t=l[u].getElementsByTagNameNS("*","image"),h=0;h<t.length;h++)"smpte:image"===t[h].nodeName&&(i=document.createElement("img"),(o=document.createElement("div")).style.left=0,o.style.right=0,o.style.bottom=0,o.style.position="absolute",i.style.verticalAlign="bottom",n=(n=t[h].getAttribute("imagetype"))&&""!==n?n.toLowerCase():"png",i.src="data:image/"+n+";base64,"+t[h].textContent,r=window.atob(t[h].textContent),s=this._getLongData(r,16),a=this._getLongData(r,20),s>0&&a>0&&(i.style.width=this._divWidth*(s/this._videoWidth)+"px",i.style.height=this._divHeight*(a/this._videoHeight)+"px",i.style.maxWidth=s+"px",i.style.maxHeight=a+"px"),o.appendChild(i),l[u].parentNode.insertBefore(o,l[u]));l[u].parentNode.removeChild(l[u])}},t.prototype._drawSMPTEXML=function(e){var t;e&&1===e.length&&(e[0].getElementsByTagName("metadata").length>0&&this._createImgTagsFromMetadata(e[0]),(t=document.createElement("div")).innerHTML=(new XMLSerializer).serializeToString(e[0]).replace("&lt;br&gt;","<br/>"),this._parseAndApplyInlineAttributes(t),this._addSpacesToEmptyPTags(t),this._addLineBreaksToPTags(t),this._appendRegions(t))},t.prototype._createDivForRegion=function(e){var t=document.createElement("div"),i=document.createElement("div"),n=this._mainSubtitleDiv.getBoundingClientRect().height;return t.style.display="table",t.style.position="absolute",t.style.backgroundColor="transparent",t.style.direction="ltr",t.style.fontStyle="normal",t.style.fontWeight="normal",t.style.opacity=1,t.style.padding="0px",t.style.textAlign="center",t.style.textDecoration="none",t.style.fontSize=n/this._cellResolutionRows/1.25+"px",t.style.lineHeight="125%",t.style.width="80%",t.style.height="20%",t.style.left="10%",t.style.top="70%",i.style.display="table-cell",i.style.verticalAlign="top",t.appendChild(i),this._mainSubtitleDiv.appendChild(t),t},t.prototype._appendRegions=function(e){var t,i,n,o=e.getElementsByTagName("*");for(t=o.length-1;t>=0;t--)for(n=o[t].attributes,i=0;i<n.length;i++)if("REGION"===n[i].name.toUpperCase()){this._regionDivLookup[n[i].value]&&("DIV"===o[t].nodeName&&(o[t].style.width="100%",o[t].style.height="100%"),this._regionDivLookup[n[i].value].childNodes[0].appendChild(o[t]),this._repositionIfOverflowVideo(this._regionDivLookup[n[i].value]));break}},t.prototype._applyAttribute=function(e,t,i,n){var o,r,s,a,l;switch(e.toUpperCase()){case"ORIGIN":2===(o=t.split(" ")).length&&(i.style.left=o[0],i.style.top=o[1]);break;case"EXTENT":2===(o=t.split(" ")).length&&(i.style.width=o[0],i.style.height=o[1]);break;case"DISPLAYALIGN":switch(t){case"before":r="top";break;case"center":r="middle";break;case"after":r="bottom"}i.childNodes[0].style.verticalAlign=r;break;case"SHOWBACKGROUND":break;case"TEXTDECORATION":switch(t){case"underline":r="underline";break;case"lineThrough":r="line-through";break;case"overline":r="overline";break;default:r="none"}i.style.textDecoration=r;break;case"TEXTOUTLINE":r="-"+(s=(o=t.split(" "))[1]||"0")+" -"+s+" "+(a=o[2]||"0")+" "+(l=o[0])+", "+s+" -"+s+" "+a+" "+l+", -"+s+" "+s+" "+a+" "+l+", "+s+" "+s+" "+a+" "+l,i.style.textShadow=r;break;case"FONTSIZE":t.indexOf("%")>-1&&n&&(t=this._mainSubtitleDiv.getBoundingClientRect().height/this._cellResolutionRows/100*parseFloat(t)/1.25+"px"),i.style.fontSize=t;break;case"WRAPOPTION":i.style.whiteSpace="noWrap"===t?"nowrap":"pre-wrap";break;case"WRITINGMODE":switch(t){case"lrtb":r="lr-tb";break;case"rltb":r="rl-tb";break;case"tbrl":r="tb-rl";break;case"tblr":r="tb";break;case"lr":r="lr";break;case"rl":r="rl";break;case"tb":r="tb";break;default:r="lr-tb"}i.style.webkitWritingMode=r;break;case"ZINDEX":i.style.zIndex=t;break;case"BACKGROUNDCOLOR":i.style.backgroundColor=t;break;case"COLOR":i.style.color=t;break;case"TEXTALIGN":i.style.textAlign=t;break;case"PADDING":i.style.padding=t;break;case"FONTFAMILY":i.style.fontFamily=t;break;case"LINEHEIGHT":i.style.lineHeight=t;break;case"OPACITY":i.style.opacity=t;break;case"OVERFLOW":i.style.overflow=t;break;case"DIRECTION":i.style.direction=t;break;case"DISPLAY":i.style.display=t;break;case"UNICODEBIDI":i.style.unicodeBidi=t;break;case"VISIBILITY":i.style.visibility=t;break;case"FONTSTYLE":i.style.fontStyle=t;break;case"FONTWEIGHT":i.style.fontWeight=t}},t.prototype._parseAndApplyAttributes=function(e,t){var i,n=e.attributes;for(i=0;i<n.length;i++)this._applyAttribute(n[i].localName,n[i].value,t,!0)},t.prototype._parseAndApplyInlineAttributes=function(e){var t,i,n,o=e.getElementsByTagName("*");for(t=0;t<o.length;t++)for(n=o[t].attributes,i=0;i<n.length;i++)this._applyAttribute(n[i].name.replace("tts:",""),n[i].value,o[t])},t.prototype._parseAndApplyRegionStyleTags=function(e,t){var i,n,o,r=e.getElementsByTagName("style");for(i=0;i<r.length;i++)for(o=r[i].attributes,n=0;n<o.length;n++)this._applyAttribute(o[n].localName,o[n].value,t,!0)},t.prototype._drawRegions=function(e){var t,i,n;if(e&&e.length>0)for(t=e[0].getElementsByTagName("region"),i=0;i<t.length;i++)n=this._createDivForRegion(t[i]),this._regionDivLookup[t[i].getAttribute("xml:id")]=n,this._parseAndApplyAttributes(t[i],n),this._parseAndApplyRegionStyleTags(t[i],n)},t.prototype._setCellResolution=function(e){var t;this._cellResolutionRows=15,e&&e[0]&&(t=e[0].getAttribute("ttp:cellResolution"))&&(this._cellResolutionRows=parseInt(t.split(" ")[1],10))},t.prototype.onSMPTESubtitleChanged=function(e,t){var i;this.clearScreen(),this._regionDivLookup={},this._mainSubtitleDiv&&e&&e.text&&(i=(new DOMParser).parseFromString(e.text,"text/xml"),this._setCellResolution(i.getElementsByTagName("tt")),this._drawRegions(i.getElementsByTagName("head")),this._drawSMPTEXML(i.getElementsByTagName("body")),t||this._clearScreenTimer.setDuration(e.endTime-e.startTime,!0)),this._displayedSMPTEJson=e},t.prototype._subtitlesActivated=function(){this.clearScreen()},t.prototype._subtitlesDeactivated=function(){this.clearScreen()},t}),i("PlaybackAgent",["util/CommonTools","util/AsyncAgent","MessageBroker","WebVTTSubtitleRenderer","SMPTESubtitleRenderer"],function(e,t,i,n,o){function r(){var e=this;this._messageBroker=i,this._messageBroker.registerTarget(this),this._bufferedDuration=0,this._streamBitrate=null,this._error=null,this._audioTracks=[],this._subtitlingTracks=[],this._maxBandwidth=0,this._id3TagIdentifier=0,this._id3TagVersion=0,this._id3TagTimestamp=0,this._id3FrameLookup={},this._webVTTSubtitleRenderer=new n,this._smpteSubtitleRenderer=new o,this.addEventListener("webVTTSubtitleChanged",function(t,i){e._smpteSubtitleRenderer.clearScreen(),e._webVTTSubtitleRenderer.onWebVTTSubtitleChanged(t,i)}),this.addEventListener("smpteSubtitleChanged",function(t){e._webVTTSubtitleRenderer.clearScreen(),e._smpteSubtitleRenderer.onSMPTESubtitleChanged(t)}),this.addEventListener("viewDidChange",function(t){e._webVTTSubtitleRenderer.onViewDidChange(t),e._smpteSubtitleRenderer.onViewDidChange(t)}),this.addEventListener("tracksChanged",function(){e._checkForActiveSubtitles()})}return r.prototype.getName=function(){return"playbackAgent"},r.prototype.activateTrack=function(e){if(!e.active){var t=this._messageBroker.createMessage("playbackAgent",this,"activateTrack",[e]),i=this._messageBroker.sendMessage(t,!0);return i&&this._updateTracks(e,!0),i}return!1},r.prototype.deactivateTrack=function(e){if(e.type!==this.TrackType.AUDIO&&e.active){var t=this._messageBroker.createMessage("playbackAgent",this,"deactivateTrack",[e]),i=this._messageBroker.sendMessage(t,!0);return this._log("deactivateTrack","Received result "+i),i&&this._updateTracks(e,!1),i}return this._log("deactivateTrack","Returning FALSE"),!1},r.prototype._updateTracks=function(e,t){var i=[];if(e.type===this.TrackType.AUDIO?i=this.audioTracks:e.type===this.TrackType.SUBTITLE&&(i=this.subtitlingTracks),e.type!==this.TrackType.AUDIO||i.length>1)for(var n=0;n<i.length;n++)t&&e.language===i[n].language&&e.name===i[n].name?t&&e.language===i[n].language&&e.name===i[n].name&&(i[n].active=!0):i[n].active=!1;this._checkForActiveSubtitles()},r.prototype._checkForActiveSubtitles=function(){for(var e=0;e<this.subtitlingTracks.length;e++)if(this.subtitlingTracks[e].active)return this._webVTTSubtitleRenderer._subtitlesActivated(),void this._smpteSubtitleRenderer._subtitlesActivated();this._webVTTSubtitleRenderer._subtitlesDeactivated(),this._smpteSubtitleRenderer._subtitlesDeactivated()},Object.defineProperty(r.prototype,"bufferedDuration",{get:function(){var e=this._messageBroker.createMessage("playbackAgent",this,"getBufferedDuration",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"streamBitrate",{get:function(){return this._streamBitrate?this._streamBitrate:null},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"audioTracks",{get:function(){return this._audioTracks},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"subtitlingTracks",{get:function(){return this._subtitlingTracks},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"maxBandwidth",{get:function(){return this._maxBandwidth},set:function(e){this._log("maxBandwidth","Setting maxBandwidth to "+e);var t=this._messageBroker.createMessage("videoAgent",this,"setMaxBandwidth",[e]);this._messageBroker.sendMessage(t),this._maxBandwidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ID3Tag",{get:function(){var e=this;return this._id3TagIdentifier?{identifier:this._id3TagIdentifier,version:this._id3TagVersion,timestamp:Math.round(1e3*this._id3TagTimestamp)/1e3,getFrameById:function(t){return e._id3FrameLookup[t]?e._id3FrameLookup[t]:[]}}:null},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"programDateTime",{get:function(){var e=this._messageBroker.createMessage("playbackAgent",this,"getProgramDateTime",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),r.prototype.TPlaybackError={PLAYBACK_DEMUXING_ERROR:1,PLAYBACK_DECODING_ERROR:2,PLAYBACK_DESCRAMBLING_ERROR:3,PLAYBACK_CONTAINER_NOT_SUPPORTED:100,PLAYBACK_CODEC_NOT_SUPPORTED:101},r.prototype.TrackType={AUDIO:0,SUBTITLE:2},e.extend(r.prototype,t),r}),i("CCSettingsAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._DEFAULT_FONT="Tahoma",this._characterColor=this.TCCColor.COLOR_DEFAULT,this._characterOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._characterSize=100,this._fonts=[{name:this._DEFAULT_FONT,style:this.TCCFontStyle.STYLE_DEFAULT},{name:"Courier New",style:this.TCCFontStyle.STYLE_MONOSPACED_SERIFS},{name:"Times Roman",style:this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS},{name:"Windings",style:this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS},{name:"Century Gothic",style:this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS},{name:"Lucinda Casual",style:this.TCCFontStyle.STYLE_CASUAL},{name:"Coronet",style:this.TCCFontStyle.STYLE_CURSIVE},{name:"Engravers Gothic",style:this.TCCFontStyle.STYLE_SMALL_CAPITALS}],this._captionBackgroundColor=this.TCCColor.COLOR_DEFAULT,this._captionBackgroundOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._characterEdgeAttributes=this.TCCEdgeAttribute.EDGE_DEFAULT,this._characterEdgeColor=this.TCCColor.COLOR_DEFAULT,this._captionWindowColor=this.TCCColor.COLOR_DEFAULT,this._captionWindowOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._createFontLookup(),this._createColorsLookup(),this._createOpacitiesLookup(),this._createEdgeAttributesLookup(),this._createDefaultFontTypesLookup()}return n.prototype._createFontLookup=function(){this._fontLookup={},this._fontLookup[this.TCCFontStyle.STYLE_DEFAULT]=["Courier","Courier New","Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman","Lucida Console","Lucida Sans Typewriter","Terminal","Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana","Comic Sans MS","Bradley Hand ITC","Monotype Corsiva","Papyrus"],this._fontLookup[this.TCCFontStyle.STYLE_MONOSPACED_SERIFS]=["Courier","Courier New"],this._fontLookup[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS]=["Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman"],this._fontLookup[this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS]=["Lucida Console","Lucida Sans Typewriter","Terminal"],this._fontLookup[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS]=["Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana"],this._fontLookup[this.TCCFontStyle.STYLE_CASUAL]=["Comic Sans MS"],this._fontLookup[this.TCCFontStyle.STYLE_CURSIVE]=["Bradley Hand ITC","Monotype Corsiva","Papyrus"],this._fontLookup[this.TCCFontStyle.STYLE_SMALL_CAPITALS]=["Courier","Courier New","Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman","Lucida Console","Lucida Sans Typewriter","Terminal","Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana","Comic Sans MS","Bradley Hand ITC","Monotype Corsiva","Papyrus"]},n.prototype._createColorsLookup=function(){this._cssStylesLookupForColors={},this._cssStylesLookupForColors[this.TCCColor.COLOR_DEFAULT]="0,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_WHITE]="255,255,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_BLACK]="0,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_RED]="255,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_GREEN]="0,128,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_BLUE]="0,0,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_YELLOW]="255,255,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_MAGENTA]="255,0,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_CYAN]="0,255,255"},n.prototype._createEdgeAttributesLookup=function(){this._cssStylesLookupForEdgeAttributes={},this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DEFAULT]=null,this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_NONE]="NONE",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_RAISED]="RAISED",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DEPRESSED]="DEPRESSED",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_UNIFORM]="UNIFORM",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DROP_SHADOWED]="SHADOW"},n.prototype._createOpacitiesLookup=function(){this._cssStylesLookupForOpacities={},this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_DEFAULT]=1,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_TRANSPARENT]=0,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_SEMI_TRANSPARENT_25]=.25,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_SEMI_TRANSPARENT_75]=.75,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_OPAQUE]=1},n.prototype._createDefaultFontTypesLookup=function(){this._defaultFontLookupForFontTypes={},this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_DEFAULT]="",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_MONOSPACED_SERIFS]=", monospaced",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS]=", serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS]=", sans-serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS]=", sans-serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_CASUAL]="",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_CURSIVE]=", cursive",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_SMALL_CAPITALS]=""},n.prototype.getSystemFonts=function(e){return this._fontLookup[e]?this._fontLookup[e]:[]},n.prototype.getName=function(){return"ccSettingsAgent"},n.prototype._validateColor=function(e){return e<-1||e>7?this.TCCColor.COLOR_DEFAULT:e},n.prototype._validateOpacity=function(e){return-1!==e&&0!==e&&25!==e&&75!==e&&100!==e?this.TCCOpacity.OPACITY_DEFAULT:e},Object.defineProperty(n.prototype,"characterColor",{get:function(){return this._characterColor},set:function(e){this._characterColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterOpacity",{get:function(){return this._characterOpacity},set:function(e){this._characterOpacity=this._validateOpacity(e),this._createEdgeAttributesLookup(),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterSize",{get:function(){return this._characterSize},set:function(e){e<50?e=50:e>200&&(e=200),e>=50&&e<=200&&(this._characterSize=e,this._fireSettingsChangedEvent())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fonts",{get:function(){return this._fonts},set:function(e){this._fonts=e,this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"captionBackgroundColor",{get:function(){return this._captionBackgroundColor},set:function(e){this._captionBackgroundColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"captionBackgroundOpacity",{get:function(){return this._captionBackgroundOpacity},set:function(e){this._captionBackgroundOpacity=this._validateOpacity(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterEdgeAttributes",{get:function(){return this._characterEdgeAttributes},set:function(e){(e<-1||e>4)&&(e=this.TCCEdgeAttribute.EDGE_DEFAULT),this._characterEdgeAttributes=e,this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterEdgeColor",{get:function(){return this._characterEdgeColor},set:function(e){this._characterEdgeColor=this._validateColor(e),this._createEdgeAttributesLookup(),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"captionWindowColor",{get:function(){return this._captionWindowColor},set:function(e){this._captionWindowColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"captionWindowOpacity",{get:function(){return this._captionWindowOpacity},set:function(e){this._captionWindowOpacity=this._validateOpacity(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),n.prototype.TCCFontStyle={STYLE_DEFAULT:0,STYLE_MONOSPACED_SERIFS:1,STYLE_PROPORTIONALLY_SPACED_SERIFS:2,STYLE_MONOSPACED_SANS_SERIFS:3,STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS:4,STYLE_CASUAL:5,STYLE_CURSIVE:6,STYLE_SMALL_CAPITALS:7},n.prototype.TCCColor={COLOR_DEFAULT:-1,COLOR_WHITE:0,COLOR_BLACK:1,COLOR_RED:2,COLOR_GREEN:3,COLOR_BLUE:4,COLOR_YELLOW:5,COLOR_MAGENTA:6,COLOR_CYAN:7},n.prototype.TCCOpacity={OPACITY_DEFAULT:-1,OPACITY_TRANSPARENT:0,OPACITY_SEMI_TRANSPARENT_25:25,OPACITY_SEMI_TRANSPARENT_75:75,OPACITY_OPAQUE:100},n.prototype.TCCEdgeAttribute={EDGE_DEFAULT:-1,EDGE_NONE:0,EDGE_RAISED:1,EDGE_DEPRESSED:2,EDGE_UNIFORM:3,EDGE_DROP_SHADOWED:4},n.prototype._fireSettingsChangedEvent=function(){var e,t=this._characterEdgeColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._characterEdgeColor];e=this._captionWindowColor===this.TCCColor.COLOR_DEFAULT?"rgba("+this._cssStylesLookupForColors[this._captionWindowColor]+", 0)":"rgba("+this._cssStylesLookupForColors[this._captionWindowColor]+","+this._cssStylesLookupForOpacities[this._captionWindowOpacity]+")";var i={fontColor:this._characterColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._characterColor],fontOpacity:this._characterOpacity===this.TCCOpacity.OPACITY_DEFAULT?null:this._cssStylesLookupForOpacities[this._characterOpacity],fontSize:this._characterSize,fonts:this._fonts,captionBackgroundColor:this._captionBackgroundColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._captionBackgroundColor],captionBackgroundOpacity:this._captionBackgroundOpacity===this.TCCOpacity.OPACITY_DEFAULT?null:this._cssStylesLookupForOpacities[this._captionBackgroundOpacity],edgeRGB:t,edgeAttribute:this._cssStylesLookupForEdgeAttributes[this._characterEdgeAttributes],captionWindowColor:e};this._fireEvent("ccSettingsChanged",i)},e.extend(n.prototype,t),n}),i("RenderingAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._messageBroker=i,this._messageBroker.registerTarget(this)}return n.prototype.getName=function(){return"renderingAgent"},Object.defineProperty(n.prototype,"video",{get:function(){var e=this._messageBroker.createMessage("renderingAgent",this,"getVideoObject",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),e.extend(n.prototype,t),n}),i("SecureStorageAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._messageBroker=i,this._messageBroker.registerTarget(this)}return n.prototype.getItem=function(e){var t=this._messageBroker.createMessage("secureStorageAgent",this,"getItem",[e]);return this._messageBroker.sendMessage(t,!0)},n.prototype.setItem=function(e,t){t="number"==typeof t?t+"":t;var i=this._messageBroker.createMessage("secureStorageAgent",this,"setItem",[e,t]);return this._messageBroker.sendMessage(i,!1),!0},n.prototype.removeItem=function(e){var t=this._messageBroker.createMessage("secureStorageAgent",this,"removeItem",[e]);this._messageBroker.sendMessage(t,!1)},n.prototype.clear=function(){var e=this._messageBroker.createMessage("secureStorageAgent",this,"clear",[]);this._messageBroker.sendMessage(e,!1)},n.prototype.getName=function(){return"secureStorageAgent"},e.extend(n.prototype,t),n}),i("ConfigAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,i){function n(){this._messageBroker=i,this._messageBroker.registerTarget(this)}return n.prototype.getName=function(){return"configAgent"},n.prototype.setLogTarget=function(e){var t=this._messageBroker.createMessage("configAgent",this,"setLogTarget",[e]);this._messageBroker.sendMessage(t)},n.prototype.setLogLevel=function(e){var t=this._messageBroker.createMessage("configAgent",this,"setLogLevel",[e]);this._messageBroker.sendMessage(t)},e.extend(n.prototype,t),n}),Object.defineProperty(window,"__NMPPluginLoaded",{get:function(){return function(e){NMP._pluginLoaded(e)}},configurable:!1}),i("NMP",["DRMAgent","UserAgent","VideoAgent","NetworkAgent","PlaybackAgent","CCSettingsAgent","RenderingAgent","SecureStorageAgent","ConfigAgent","util/CommonTools"],function(e,i,n,o,r,s,a,l,u,h){window.NMP=window.NMP||{},this._isReady=!1;var c,p,_,g,d,f,y,m,S,b=null;function E(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("nmp-extension-message",!0,!0,{action:e}),window.parent.document.dispatchEvent(t)}return NMP._deleteHttpFsFiles=function(){t(["fs"],function(e){e.deleteAllPersistentFiles(),NMP.ready=!1})},NMP._pluginInitialised=function(){this._isReady=!0,c.onload&&"function"==typeof c.onload&&c.onload.call()},NMP._pluginLoaded=function(T){var C=this;if(p=new e,_=new i,g=new o,d=new r,f=new s,y=new a,m=new l,S=new u,window.NMP.drmAgent=p,window.NMP.userAgent=_,window.NMP.networkAgent=g,window.NMP.playbackAgent=d,window.NMP.ccSettingsAgent=f,window.NMP.renderingAgent=y,window.NMP.secureStorageAgent=m,window.NMP.configAgent=S,b=b||t("MessageBroker"),(c=document.getElementsByTagName("nmp-video")[0]||new n).videoElement=c,c.drmAgent=window.NMP.drmAgent,c.userAgent=window.NMP.userAgent,c.networkAgent=window.NMP.networkAgent,c.playbackAgent=window.NMP.playbackAgent,c.ccSettingsAgent=window.NMP.ccSettingsAgent,c.renderingAgent=window.NMP.renderingAgent,c.secureStorageAgent=window.NMP.secureStorageAgent,c.configAgent=window.NMP.configAgent,c._subtitleElem&&(d._webVTTSubtitleRenderer.setMainSubtitleDiv(c._subtitleElem),d._smpteSubtitleRenderer.setMainSubtitleDiv(c._subtitleElem),f.addEventListener("ccSettingsChanged",function(e){d._webVTTSubtitleRenderer.onCCSettingsChanged(e)}),c.addEventListener("videoSizeChanged",function(){d._webVTTSubtitleRenderer.onVideoSizeChanged(c.videoWidth,c.videoHeight),d._smpteSubtitleRenderer.onVideoSizeChanged(c.videoWidth,c.videoHeight)}),g.addEventListener("availableBitratesChanged",function(){c._setPendingSetSource(!1)}),f._fireSettingsChangedEvent(),c.addEventListener("pause",function(){E("PowerSavingOn"),d._webVTTSubtitleRenderer.onPause(),d._smpteSubtitleRenderer.onPause()}),c.addEventListener("play",function(){E("PowerSavingOff"),d._webVTTSubtitleRenderer.onPlay(),d._smpteSubtitleRenderer.onPlay()}),c.addEventListener("waiting",function(){d._webVTTSubtitleRenderer.onPause(),d._smpteSubtitleRenderer.onPause()}),c.addEventListener("seeking",function(){d._webVTTSubtitleRenderer.clearScreen(),d._smpteSubtitleRenderer.clearScreen()}),c.addEventListener("ended",function(){E("PowerSavingOn"),d._webVTTSubtitleRenderer.clearScreen(),d._smpteSubtitleRenderer.clearScreen()}),c.addEventListener("abort",function(){E("PowerSavingOn"),d._webVTTSubtitleRenderer.clearScreen(),d._smpteSubtitleRenderer.clearScreen()}),c.addEventListener("error",function(){E("PowerSavingOn"),d._webVTTSubtitleRenderer.clearScreen(),d._smpteSubtitleRenderer.clearScreen()})),E("RequestDeviceInformation"),window.NMP.videoAgent=c,b.setPluginInstance(T),h.isDesktop())this._pluginInitialised();else{var O=function(e){"NMPJSREADY"===e.data?(T.removeEventListener("message",O),C._pluginInitialised()):"NMPJSERROR"===e.data&&(T.removeEventListener("message",O),console.error("JS Bridge Creation Failed"),c.onerror&&"function"==typeof c.onerror&&c.onerror.call())};T.addEventListener("message",O)}},Object.defineProperty(window.NMP,"ready",{get:function(){return this._isReady}}),Object.defineProperty(window.NMP,"buildNumber",{get:function(){return"Release#43"}}),window.NMP}),t("NMP")}();