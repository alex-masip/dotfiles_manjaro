!function(){function a(e,n){return chrome.runtime.sendMessage({name:e,subject:n})}var d=[],u=[],p=[],f=!1,l=0,m=[];function h(e,n,t,r,i){var o=e.responseText.match(/livetest\/bookmarklet\.php\?r='\+Math\.random\(\)\+'&nb='\+top\.tc_count\+'&container=([\d]+)!([\d]+)&version=([\d]+\.[\d]+)/);if(null!=o){var a=o[1],s=o[2],c=o[3],d=$.grep(m,function(e){return e.idContainer==s&&e.idSite==a});$.isEmptyObject(d)&&m.push({url:n,idContainer:s,idSite:a,versionLabel:c,position:r})}++l==t&&(l=0,m.sort(function(e,n){return e.position>n.position?1:n.position>e.position?-1:0}),i())}a("setBadge",0),chrome.runtime.onMessage.addListener(function(e,n,t){switch(e.name){case"popup":switch(e.subject){case"tags":t({containers:d,tags:u});break;case"vars":var r=function e(n){if("object"!=typeof n||null===n)return n;var t={};for(var r in n)t[r]=e(n[r]);return t}(p);t(r);break;case"cookies":return chrome.runtime.sendMessage({name:"content",subject:"cookies"},function(e){t(e)}),!0;case"containers":for(var i in d){var o=d[i].generatorVersion;if(void 0===o||0<parseInt(o,10)&&parseInt(o,10)<7){f=!0;break}}f?function(t){m=[];var r=[];$.each(window.performance.getEntries(),function(e,n){"script"===n.initiatorType&&r.push(n.name)}),r.reverse();for(var i=[],e=0;e<r.length;e++){var o=r[e];-1==o.indexOf("extension/downloadversion/")&&function(e,n){i[e]=new XMLHttpRequest,i[e].open("GET",o),i[e].onload=function(){h(i[e],n[e],n.length,e,t)},i[e].send()}(e,r)}}(function(){t(m)}):t(d);break;case"scripts":var a=window.performance.getEntries(),s=[];for(i=0;i<a.length;i++)"script"===a[i].initiatorType&&-1==a[i].name.indexOf(window.location.hostname.replace("www.",""))&&s.push({name:a[i].name,duration:a[i].duration});t(s);break;case"pixels":a=window.performance.getEntries();var c=[];for(i=0;i<a.length;i++)"img"!==a[i].initiatorType||-1!=a[i].name.indexOf(window.location.hostname.replace("www.",""))||/png|jpg/.test(a[i].name.split(".").pop())||c.push({name:a[i].name,duration:a[i].duration});t(c)}return!0}}),window.addEventListener("message",function(e){var n=e.data;if("string"==typeof n)switch(0){case n.indexOf("TC.EX:{"):n=n.substr(6);try{var t=JSON.parse(n);0==(i=$.map(u,function(e,n){if(e.idTag==t.id&&e.idContainer==t.idc&&e.idSite==t.ids)return n})).length&&u.push({name:t.lb,idTag:t.id,idContainer:t.idc,idSite:t.ids}),a("setBadge",u.length)}catch(e){}break;case n.indexOf("TC.EX.CONTAINER:{"):var r;n=n.substr(16);try{r=JSON.parse(n)}catch(e){try{r=JSON.parse(n.replace("undefined",1e7))}catch(e){console.error("Parse error on TC.EX.CONTAINER",e)}}r.url&&r.g<7&&(r.g=7);try{var i,o={url:r.url,idContainer:r.id,idSite:r.ids,versionLabel:r.v,position:r.p,generatorVersion:r.g};0<(i=$.map(d,function(e,n){if(e.idContainer==r.id&&e.idSite==r.ids)return n})).length&&0<parseInt(r.g,10)&&7<=parseInt(r.g,10)?d[i[0]]=o:0==i.length&&d.push(o)}catch(e){console.error(e)}}else"object"==typeof n&&n.subject&&"tcvars"==n.subject&&(p=n.data)});var e=document.createElement("script");e.src=chrome.extension.getURL("js/taglistener.js"),e.onload=function(){this.parentNode.removeChild(this)},(document.head||document.documentElement).appendChild(e)}();