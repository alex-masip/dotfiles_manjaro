!function(){var r={},o={},i={},c={},d={},m={},g=!1;chrome.runtime.onConnect.addListener(function(s){function a(t,e,n){switch(t.name){case"init":r[t.tabId]=s,o[t.tabId]=!0,i[t.tabId]=t.currentHostname;break;case"changeMenu":chrome.tabs.query({active:!0,currentWindow:!0},function(e){e[0]&&(chrome.tabs.sendMessage(e[0].id,{name:"changeMenu",activeMenuItem:t.activeMenuItem}),o[e[0].id]="event-listener"==t.activeMenuItem),d={}});break;case"settings":for(tabId in chrome.storage.local.remove("tcsettings"),chrome.storage.local.set({tcsettings:t.settings}),chrome.tabs.query({},function(e){for(var t=0;t<e.length;t++)e[t]&&chrome.tabs.sendMessage(e[t].id,{name:"saveSettings"})}),r)r[tabId].postMessage({name:"changeSettings",tabId:tabId});c=t.settings}}"devtools-panel"==s.name?s.onMessage.addListener(a):"devtools"==s.name&&(chrome.webRequest.onBeforeRedirect.addListener(function(e){-1==e.redirectUrl.indexOf("/crossroad/login")&&s.postMessage({name:"login"})},{urls:["*://*.commandersact.com/crossroad/login_check"]}),chrome.webRequest.onHeadersReceived.addListener(function(e){s.postMessage({name:"logout"}),chrome.tabs.query({},function(e){for(var t=0;t<e.length;t++)e[t]&&chrome.tabs.sendMessage(e[t].id,{name:"removeEvents"})})},{urls:["*://*.commandersact.com/logout"]}),s.onMessage.addListener(a),s.onDisconnect.addListener(function(e){e.onMessage.removeListener(a);for(var t=Object.keys(r),n=0,s=t.length;n<s;n++)if(r[t[n]]==e){delete r[t[n]],delete o[t[n]];break}}),chrome.tabs.onUpdated.addListener(function(e,t,n){var s=document.createElement("a");s.href=n.url,e in r&&s.hostname!=i[e]&&(r[e].postMessage({name:"changeHostname",tabId:e}),i[e]=s.hostname),g=!1}))}),chrome.runtime.onMessage.addListener(function(t,n,e){switch(t.name){case"sendElementInfo":g=!1,m={},setTimeout(function(){if(0==Object.keys(d).length&&function(e){var t=!1;if("scroll"!=e.eventtype){var n="click"==e.eventtype?1:0,s="click"==e.eventtype?0:1;0==Object.keys(c).length?t=!0:(1==c.click&&1==n||1==c.form&&1==s)&&(t=!0)}else 0<Object.keys(c).length&&("y"==e.elementInfo.scrollType&&1==c["scroll-y"].checked&&(t=!0),"x"==e.elementInfo.scrollType&&1==c["scroll-x"].checked&&(t=!0));return t}(t)){if(n.tab){var e=n.tab.id;e in r&&r[e].postMessage({name:"sendElementInfo",type:t.type,elementInfo:t.elementInfo,tabId:e})}}else m=JSON.parse(JSON.stringify(t))},10);break;case"checkIsConnected":chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(e[0]){var t=!!o[e[0].id];e[0]&&chrome.tabs.sendMessage(e[0].id,{name:"getIsConnected",isConnected:isConnected&&t})}});break;case"login":for(tabId in r)r[tabId].postMessage({name:"login",tabId:tabId})}return!0}),chrome.runtime.onMessage.addListener(function(e,t,n){switch(e.name){case"triggers":var s=JSON.parse(e.msg);d.hasOwnProperty("trigger_"+s.id)||(d["trigger_"+s.id]={id:s.id,name:s.name,tags:[]});break;case"tags":var a=JSON.parse(e.msg);d.hasOwnProperty("trigger_"+a.idtr)&&d["trigger_"+a.idtr].tags.push({name:a.lb,tag_id:a.id,site_id:a.ids,trigger_id:a.idtr})}return 0<Object.keys(d).length&&!1===g&&(m={},g=!0,setTimeout(function(){if(t.tab){var e=t.tab.id;e in r&&0<Object.keys(m).length&&(r[e].postMessage({name:"sendTriggersInfo",type:m.type,elementInfo:m.elementInfo,triggersInfo:d,tabId:e}),g=!1)}d={}},50)),!0})}();