var containersToReplace={},isConnected=!1;function addContainersToReplace(e){containersToReplace=e}!function(){function o(e){return(e.match(/(?:.*\/)*(.+\.js).*/)||[])[1]}chrome.storage.local.get("containersToReplace",function(e){chrome.runtime.lastError&&console.log(chrome.runtime.lastError),e.containersToReplace&&(containersToReplace=e.containersToReplace)}),chrome.browserAction.setBadgeBackgroundColor({color:"#000"}),chrome.runtime.onMessage.addListener(function(e,o,n){switch(e.name){case"setBadge":chrome.browserAction.setBadgeText({text:e.subject.toString(),tabId:o.tab.id})}}),chrome.notifications.onButtonClicked.addListener(function(e,o){var n=e.split("_");containersToReplace[n[1]+"_"+n[2]]&&delete containersToReplace[n[1]+"_"+n[2]],chrome.storage.local.get("containersToReplace",function(e){if(e.containersToReplace){var o=e.containersToReplace;o[n[1]+"_"+n[2]]&&(delete o[n[1]+"_"+n[2]],chrome.storage.local.remove("containersToReplace"),chrome.storage.local.set({containersToReplace:o}))}}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.reload(e[0].id)})}),chrome.webRequest.onBeforeRequest.addListener(function(e){return{cancel:!0}},{urls:["http://cdn.tagcommander.com/tagperf/tagsHierarchy.js"],types:["script"]},["blocking"]),chrome.webRequest.onBeforeRequest.addListener(function(e){if(isConnected){var c=containersToReplace;for(container in c){if(o(e.url)===o(c[container].url))return setTimeout(function(){var e,o,n,t;e=c[container].containerName,o=c[container].site,n=c[container].container,t={type:"basic",title:"Commanders Act Analyser",message:'Container "'+e+'" replaced.',iconUrl:"img/icon-128.png",buttons:[{title:"Click here to restore live version"}]},chrome.notifications.create("containers_"+o+"_"+n,t,function(e){}),setTimeout(function(e,o){chrome.notifications.clear("containers_"+e+"_"+o,function(){})},6e3,o,n)},1),{redirectUrl:"https://platform.commandersact.com/en/"+c[container].site+"/containers/extension/downloadversion/"+c[container].container+"/"+c[container].version}}}},{urls:["<all_urls>"],types:Array("script")},["blocking"]),chrome.webRequest.onHeadersReceived.addListener(function(e){console.log("logged out"),isConnected=!1},{urls:["*://*.commandersact.com/logout"]}),chrome.webRequest.onBeforeRedirect.addListener(function(e){-1==e.redirectUrl.indexOf("/crossroad/login")&&(console.log("logged in"),isConnected=!0)},{urls:["*://*.commandersact.com/crossroad/login_check"]}),chrome.webRequest.onHeadersReceived.addListener(function(e){"HTTP/1.1 401 Unauthorized"==e.statusLine&&(isConnected=!1)},{urls:["*://*.commandersact.com/*/extension/*"]}),chrome.alarms.onAlarm.addListener(function(e){switch(e.name){case"reactivateSession":isConnected=!1,chrome.runtime.sendMessage({logout:!0})}})}();