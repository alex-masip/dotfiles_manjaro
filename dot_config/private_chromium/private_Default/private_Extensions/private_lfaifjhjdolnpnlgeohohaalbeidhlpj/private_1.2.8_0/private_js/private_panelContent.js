!function(){"use strict";var v={},y={},n="TC.EX.TRIGGER.FIRED:{",s="TC.EX:{";function c(){document.addEventListener("click",e,!0),document.addEventListener("scroll",t,!0)}function o(){document.removeEventListener("click",e,!0),document.removeEventListener("scroll",t,!0)}function e(e){var t="target"in e?e.target:e.srcElement,n="submit"==t.type?"form":"click",s={type:n,nodeName:t.nodeName,className:t.className,id:t.id,target:t.target?t.target:"_self",url:"form"==t.nodeName.toLowerCase()?t.action:t.href,text:t.innerText};chrome.runtime.sendMessage({name:"sendElementInfo",type:"click",eventtype:n,elementInfo:s})}function t(e){if(!$.isEmptyObject(v)){var t={hs:0,hpc:0,ws:0,wpc:0,scrollUnit:"",scrollType:""},n=void 0!==document.height?document.height:document.body.offsetHeight,s=document.documentElement.scrollTop,c=parseInt(s/n*100),o=void 0!==document.width?document.width:document.body.offsetWidth,r=document.documentElement.scrollLeft,l=parseInt(r/o*100),i=["x","y"];for(var a in i){var m=i[a];if(1==v["scroll-"+m].checked){if("y"==m)var d="percent"==v["scroll-"+m].unit?c:s;else d="percent"==v["scroll-"+m].unit?l:r;for(var u=v["scroll-"+m].value.split(","),h=0;h<u.length;h++){var f=parseInt(u[h],10);f<=d&&!1===y[m+"_"+f]&&(y[m+"_"+f]=!0,t.scrollType=m,"percent"==v["scroll-"+m].unit?"y"==m?(t.scrollUnit="hpc",t.hpc=f):(t.scrollUnit="wpc",t.wpc=f):"y"==m?(t.scrollUnit="hs",t.hs=f):(t.scrollUnit="ws",t.ws=f),void 0,p={type:"scroll",hs:(g=t).hs,hpc:g.hpc,ws:g.ws,wpc:g.wpc,scrollUnit:g.scrollUnit,scrollType:g.scrollType},chrome.runtime.sendMessage({name:"sendElementInfo",type:"scroll",eventtype:"scroll",elementInfo:p}))}}}}var g,p}function r(){chrome.storage.local.get("tcsettings",function(e){if(chrome.runtime.lastError&&console.log(chrome.runtime.lastError),e.tcsettings){if(y={},(v=e.tcsettings)["scroll-y"]&&1==v["scroll-y"].checked)for(var t=v["scroll-y"].value.split(","),n=0;n<t.length;n++)y["y_"+t[n]]=!1;if(v["scroll-x"]&&1==v["scroll-x"].checked)for(t=v["scroll-x"].value.split(","),n=0;n<t.length;n++)y["x_"+t[n]]=!1}})}chrome.runtime.onMessage.addListener(function(e,t,n){switch(e.name){case"changeMenu":!function(e){"event-listener"==e?c():o()}(e.activeMenuItem);break;case"saveSettings":r();break;case"getIsConnected":!function(e){e&&($(document).on("visibilitychange",function(){document.hidden||c()}),c())}(e.isConnected);break;case"removeEvents":o()}}),r(),window.addEventListener("load",function(){chrome.runtime.sendMessage({name:"checkIsConnected"})},!1),window.addEventListener("message",function(e){var t=e.data;"string"==typeof t&&(0===t.indexOf(n)?(t=t.substr(n.length-1),chrome.runtime.sendMessage({name:"triggers",msg:t})):0===t.indexOf(s)&&(t=t.substr(s.length-1),chrome.runtime.sendMessage({name:"tags",msg:t})))})}();