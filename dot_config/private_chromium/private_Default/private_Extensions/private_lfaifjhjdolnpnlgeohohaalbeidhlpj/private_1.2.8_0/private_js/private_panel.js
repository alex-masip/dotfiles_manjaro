!function(){"use strict";var n=chrome.extension.connect({name:"devtools"}),l=chrome.devtools.inspectedWindow.tabId;chrome.devtools.inspectedWindow.eval("window.location.hostname",function(e,t){n.postMessage({name:"init",tabId:l,currentHostname:e})}),n.onMessage.addListener(function(e){if(l==e.tabId)switch(e.name){case"sendElementInfo":C(e.elementInfo,e.type,!0);break;case"sendTriggersInfo":!function(e,t,a){C(e,a,!1);parseInt($(".list-event li:not(.sample):visible",v).length,10);var s=parseInt($("input[name=total_items]",v).val(),10);$("li",m).removeClass("active"),$("[role=tab][data-panel=tags]",m).parent("li").addClass("active"),$(".tab-event, [role=tabpanel]",g).addClass("hide"),$(".tab-event-listener",g).removeClass("hide"),$("#tags",g).removeClass("hide"),$("#tags .no-triggers").addClass("hide"),$("#tags .div-element-info").addClass("hide");var i=$("<div/>").data("index",s).attr("id","item-"+s).addClass("div-element-info event-trigger"),n=1;for(var l in t){var r=$("<div/>",{text:"Trigger "+n+": "+t[l].name+" ("+t[l].tags.length+" tags)"}).addClass("text-triggers");i.append(r);var o=1;for(var d in t[l].tags){var c=$("<div/>",{text:"Tag "+o+": "+t[l].tags[d].name+" (ID: "+t[l].tags[d].tag_id+")"}).addClass("text-tags");i.append(c),o++}n++}$("#tags .all-triggers").append(i)}(e.elementInfo,e.triggersInfo,e.type);break;case"changeSettings":chrome.storage.local.get("tcsettings",function(e){chrome.runtime.lastError&&console.log(chrome.runtime.lastError),e.tcsettings&&(1==e.tcsettings["triggers-events"]?($(".list-event li:not(.sample)",v).addClass("hide"),$("#datalayer .div-element-info:not(.sample)",v).addClass("hide"),$("#tags .div-element-info",v).addClass("hide"),$(".list-event li:not(.sample) a.event-trigger",v).parent().removeClass("hide"),$("#datalayer .div-element-info:not(.sample).event-trigger",v).removeClass("hide"),$("#tags .div-element-info.event-trigger",v).removeClass("hide")):($(".list-event li:not(.sample)",v).removeClass("hide"),$("#datalayer .div-element-info:not(.sample)",v).removeClass("hide"),$("#tags .div-element-info",v).removeClass("hide")),$(".list-event li:not(.sample):visible",v).find("a").hasClass("active")?$(".list-event li:not(.sample):visible",v).find("a.active").click():$(".list-event li:not(.sample):visible:first",v).find("a").click(),h())});break;case"changeHostname":p()}switch(e.name){case"logout":f(),$(".app").addClass("hide"),$(".app-no-login-in").removeClass("hide");break;case"login":t(),$(".app").removeClass("hide"),$(".app-no-login-in").addClass("hide")}});var v=$(".tc-container-event-listener"),m=$(".div-container-top",v),g=$(".div-container-body",v),a=$(".div-list-event",v).offset().left;function t(){$(".drag-handle",v).mousedown(function(){$("body").mousemove(e)}),$("body").mouseup(function(){$("body").off("mousemove")}),chrome.storage.local.get("tcsettings",function(e){chrome.runtime.lastError&&console.log(chrome.runtime.lastError),e.tcsettings&&n.postMessage({name:"settings",settings:e.tcsettings,tabId:l})}),$(".tc-navbar-main li").on("click",s),$('[role="tab"]',m).on("click",i),$(".list-event a.events-item",v).on("click",d),$(".clear-events",v).on("click",c),$(".div-list-event .settings").on("click",r),$(".tab-settings .save").on("click",o),$(".tc-navbar-main li[data-tab=event-listener]").click()}function e(e){var t=e.pageX-a;$(".div-list-event",v).css("width",t),$(".drag-handle",v).css("left",$(".div-list-event",v).width())}function s(e){var t=$(e.currentTarget),a=t.data("tab");$(".tc-navbar-main li").removeClass("active"),t.addClass("active"),$(".tc-container").addClass("hide"),$(".tc-container-"+a).removeClass("hide"),n.postMessage({name:"changeMenu",activeMenuItem:a,tabId:l})}function i(e){var t=$(e.currentTarget),a=t.data("panel"),s=t.data("panel-parent");$("li",m).removeClass("active"),t.parent("li").addClass("active"),$(".tab-event, [role=tabpanel]",g).addClass("hide"),$(".tab-event-listener",g).removeClass("hide"),$("#"+a,g).removeClass("hide"),n.postMessage({name:"changeMenu",activeMenuItem:s,tabId:l})}function r(e){var t=$(e.currentTarget).data("tab");$("li",m).removeClass("active"),$(".success-msg, .error-msg",g).addClass("hide"),$(".tab-event",g).addClass("hide"),$(".tab-"+t,g).removeClass("hide"),function(){var d=$(".tab-settings");chrome.storage.local.get("tcsettings",function(e){if(chrome.runtime.lastError&&console.log(chrome.runtime.lastError),e.tcsettings){var t=1==e.tcsettings.click;$("input[name=event-settings][value=click]",d).prop("checked",t);var a=1==e.tcsettings.form;$("input[name=event-settings][value=form]",d).prop("checked",a);var s=["x","y"];for(var i in s){var n=s[i],l=1==e.tcsettings["scroll-"+n].checked;$("input[name=event-settings][value=scroll-"+n+"]",d).prop("checked",l);var r=1==e.tcsettings["scroll-"+n].checked?e.tcsettings["scroll-"+n].value:"";$("input[name=scroll-"+n+"-value]",d).val(r),1==e.tcsettings["scroll-"+n].checked?$("select[name=scroll-"+n+"-unit]",d).val(e.tcsettings["scroll-"+n].unit):$("select[name=scroll-"+n+"-unit] option:first",d).prop("selected",!0)}var o=1==e.tcsettings["triggers-events"];$("input[name=event-settings][value=triggers-events]",d).prop("checked",o)}})}()}function o(e){var t={custom:1,click:0,form:0,"scroll-y":{checked:0,value:0,unit:"percent"},"scroll-x":{checked:0,value:0,unit:"percent"},"triggers-events":0};$(".success-msg, .error-msg",g).addClass("hide"),$(".tab-settings input[name=event-settings]:checked").each(function(){"scroll-y"==$(this).val()||"scroll-x"==$(this).val()?t[$(this).val()].checked=1:t[$(this).val()]=1});var a=["x","y"];for(var s in a){var i=a[s];1==t["scroll-"+i].checked?u($("input[name=scroll-"+i+"-value]").val(),$("select[name=scroll-"+i+"-unit]").val())?(t["scroll-"+i].value=$("input[name=scroll-"+i+"-value]").val(),t["scroll-"+i].unit=$("select[name=scroll-"+i+"-unit]").val()):$(".error-msg-scroll-"+i,g).removeClass("hide"):($("input[name=scroll-"+i+"-value]").val(""),$("select[name=scroll-"+i+"-unit] option:first").prop("selected",!0))}0==$(".error-msg:visible",g).length&&($(".success-msg",g).removeClass("hide"),n.postMessage({name:"settings",settings:t,tabId:l}))}function d(e){var t=$(e.currentTarget);$(".list-event li:not(.sample)",v).find("a").removeClass("active"),t.addClass("active"),$("li",m).removeClass("active"),$(".tab-event, [role=tabpanel]",g).addClass("hide"),$(".tab-event-listener",g).removeClass("hide"),$("#datalayer .div-element-info",g).addClass("hide"),$("#tags .div-element-info",g).addClass("hide"),t.hasClass("event-trigger")?($("#tags .no-triggers",g).addClass("hide"),$("[role=tab][data-panel=tags]",m).parent("li").addClass("active"),$("#tags",g).removeClass("hide"),$("#tags #"+t.attr("id"),g).removeClass("hide")):($("#tags .no-triggers",g).removeClass("hide"),$("[role=tab][data-panel=datalayer]",m).parent("li").addClass("active"),$("#datalayer",g).removeClass("hide")),$("#datalayer #"+t.attr("id"),g).removeClass("hide")}function c(e){var t=$(".list-event li > a.active",v).data("index");$(".list-event li:not(.sample):visible > a",v).each(function(){if(parseInt($(this).data("index"),10)<t){var e=$(this).attr("id");$("#datalayer .div-element-info[id="+e+"]",v).remove(),$("#tags .div-element-info[id="+e+"]",v).remove(),$(this).parent().remove()}}),h()}function p(){$(".list-event li:not(.sample)",v).remove(),$("#datalayer .div-element-info:not(.sample)",v).remove(),$("#tags .div-element-info",v).remove()}function f(){p(),$("*").off("click"),$("*").off("scroll")}function h(){var e=$(".list-event li:not(.sample):visible",v),t=e.length;e.each(function(e){$(this).find("a span.event-num").text(t-e)})}function u(e,t){var a=/^([1-9][0-9]?|100)$/,s=/^[1-9][0-9]*$/;if(""==$.trim(e))return!1;var i=e.split(",");for(var n in i){if("pixels"==t&&!s.test(i[n]))return!1;if("percent"==t&&!a.test(i[n]))return!1}return!0}function C(e,t,a){!function(e,t){var a=$(".list-event li:not(.sample)",v),s=parseInt($(".list-event li:not(.sample):visible",v).length,10)+1,i=parseInt($("input[name=total_items]",v).val(),10)+1;a.find("a").removeClass("active");var n=$(".list-event li.sample",v).clone(!0).removeClass("hide sample");n.find(".event-num").text(s),void 0!==e&&""!=e&&n.find(".event-type").text("("+e+")"),n.find("a").data("index",i).attr("id","item-"+i).addClass("active"),t?n.find(".rond").remove():n.find("a").addClass("event-trigger"),$(".list-event ul",v).prepend(n),$("input[name=total_items]",v).val(i)}(e.type,a);var s=parseInt($("input[name=total_items]",v).val(),10),i=$("<div/>").data("index",s).attr("id","item-"+s).addClass("div-element-info");if(a?($("li",m).removeClass("active"),$("[role=tab][data-panel=datalayer]",m).parent("li").addClass("active"),$(".tab-event, [role=tabpanel]",g).addClass("hide"),$(".tab-event-listener",g).removeClass("hide"),$("#datalayer",g).removeClass("hide"),$("#tags .no-triggers").removeClass("hide"),$("#tags .div-element-info").addClass("hide")):i.addClass("event-trigger"),$("#datalayer .div-element-info").addClass("hide"),"click"==t)if("click"==e.type)var n={click_element:"nodeName",click_class:"className",click_id:"id",click_target:"target",click_url:"url",click_text:"text"};else n={form_element:"nodeName",form_class:"className",form_id:"id",form_target:"target",form_url:"url",form_text:"text"};else n={"horizontal scroll (pixels)":"hs","horizontal scroll (percent)":"hpc","vertical scroll (pixels)":"ws","vertical scroll (percent)":"wpc"};if(0<Object.keys(e).length)for(var l in n)if("click_class"==l||"form_class"==l){if(""!=e[n[l]]){var r=e[n[l]].split(" ");for(var o in r){(c=$("#datalayer .el-info.sample",v).clone().removeClass("hide sample")).find(".attr").text(l),c.find(".info").text(r[o]),i.append(c)}}}else{if("hs"==n[l]||"ws"==n[l])var d="px";else if("hpc"==n[l]||"wpc"==n[l])d="%";else d="";var c;(c=$("#datalayer .el-info.sample",v).clone().removeClass("hide sample")).find(".attr").text(l),void 0!==e.scrollUnit?e.scrollUnit==n[l]?(c.find(".info").text(e[n[l]]),c.find(".unit").text(d)):c.find(".info").text(""):c.find(".info").text(e[n[l]]),i.append(c)}$("#datalayer").append(i)}chrome.extension.getBackgroundPage().isConnected?(t(),$(".app").removeClass("hide"),$(".app-no-login-in").addClass("hide")):(f(),$(".app").addClass("hide"),$(".app-no-login-in").removeClass("hide"))}();