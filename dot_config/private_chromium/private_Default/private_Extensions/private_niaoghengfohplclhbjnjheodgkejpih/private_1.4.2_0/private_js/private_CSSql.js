var CSSql=function(){var e,t={},n=a.prototype,r=a;function a(){return this.constructor!==a?e||new a:e||void(e=this)}return r.SCOPE_PAGE="page",r.SCOPE_SESSION="session",r.SCOPE_LOCAL="local",t.defaultScope=r.SCOPE_PAGE,t.findUC=/[A-Z]/g,t.stripQuotes=/"?((?:\\"|[^"])*)"?/,t.nameValue=/(?:(\w+[\$\|~\^\*]?=)(\w+|"(?:\\"|[^"])*")(?:\s*,\s*)?)/g,t.findOR=/\|\|/g,t.schemas={},t.defaults={},t.hyphUC=function(e){return"-"+e.toLowerCase()},t.nv2dataAttr=function(e,n,r){return"[data-"+n.replace(t.findUC,t.hyphUC)+r.replace(t.stripQuotes,'"$1"]')},t.parseWhere=function(e){return'meta[name^="data"]'+e.replace(t.nameValue,t.nv2dataAttr).replace(t.findOR,',meta[name^="data"]')},t.parseProperties=function(e){for(var n={},r=e.split(","),a=r.length;a--;){var o=r[a].split("=").concat([""]);n[o[0]]=o[1].replace(t.stripQuotes,"$1")}return n},t.parseOrderBy=function(e,t){if(!e.length)return[];for(var n,r=e.split(","),a=[],o=r.length;o--;)if(n=r[o].split(" ").concat(""),-1!==t.indexOf(n[0]))switch(n[1].charAt(0).toLowerCase()){case"[":a.push({field:n[0],order:"values",values:n[1].split("").splice(1).reverse().splice(1).reverse().join("").split("|")});break;case"d":a.push({field:n[0],order:"desc",check:-1===n[1].indexOf("#")?"a":"#"});break;default:a.push({field:n[0],order:"asc",check:-1===n[1].indexOf("#")?"a ":"#"})}return a.reverse()},t.checkOrder=function(e,t,n){for(var r=-1,a=n.length;++r<a;){var o=n[r];switch(o.order){case"asc":if("#"===o.check&&Number(e[o.field])<Number(t[o.field])||e[o.field]<t[o.field])return-1;if("#"===o.check&&Number(e[o.field])>Number(t[o.field])||e[o.field]>t[o.field])return 1;break;case"desc":if("#"===o.check&&Number(e[o.field])>Number(t[o.field])||e[o.field]>t[o.field])return-1;if("#"===o.check&&Number(e[o.field])<Number(t[o.field])||e[o.field]<t[o.field])return 1;break;case"values":var i=o.values.indexOf(e[o.field]),s=o.values.indexOf(t[o.field]);if(i===s)continue;if(-1===s||i<s)return-1;if(-1===i||i>s)return 1}}return 0},t.multidimBinaryInsert=function(e,n,r){for(var a=0,o=n.length-1;a<=o;){var i=a+o>>1;t.checkOrder(e,n[i],r)>=0?a=i+1:o=i-1}return n.splice(a,0,e),n},t.compressSaveString=function(e,n,r){for(var a,o,i,s="",c=n.length;c--;)a=c.toString(32),o=n[c].replace(t.findUC,t.hyphUC),s+=(s.length?",":"")+o+"="+a,i=new RegExp("\bdata-"+o+"=","g"),r=r.replace(i,"d-"+a+"=");return r=(s="["+s+"]")+(r=(r=(r=r.replace(/<meta /g,"<m ")).replace(new RegExp('\bname="data-'+e+'"',g),'n="d-sc"')).replace(new RegExp('\bname="schema-'+e+'"',g),'n="s-sc"'))},t.uncompressSaveString=function(e,t){var n,r,a,o,i,s;for(n=(r=(t.match(/^\[([^\]]*)\]/)||["",""])[1]).split(","),t=(t=(t=t.replace(/<m /g,"<meta ")).replace(/\bn="d-sc"/g,'name="data-'+e+'"')).replace(/\bn="s-sc"/g,'name="schema-'+e+'"'),a=n.length;a--;)i=(r=n[a].split("="))[0],o=r[1],s=new RegExp("\bd-"+o+"=",g),t=t.replace(s,"data-"+i+"=");return t},t.nodeListToArray=function(e,t,n){var r,a;return void 0===t?[].slice.call(e,0):(void 0===n?(r=0,a=t<0?Math.max(l.length-t,0):t):(t<0&&(t=Math.max(l.length-t,0)),n<0&&(n=Math.max(l.length-n,0)),r=Math.min(t,n),a=Math.max(t,n)),[].slice.call(e,r,a))},t.getData=function(e,n,r,a){var o,i=t.schemas[e];return!!(i&&(n=n&&"*"!==n?t.parseWhere(n):'meta[name^="data"]',o=i.querySelectorAll(n)))&&t.nodeListToArray(o,r,a)},t.listToFragment=function(e,t){for(var n=!t,r=document.createDocumentFragment(),a=e.length;a--;)r.insertBefore(n?e[a]:e[a].cloneNode(),r.firstChild);return r},n.schemas=function(){return Object.keys(t.schemas)},n.exists=function(e){return e in t.schemas},n.define=function(e,n){e+="";var r,a,o=t.schemas[e]=document.createDocumentFragment(),i=document.createElement("meta");o.appendChild(i),i.name="schema-"+e,i.content="",n===n+""?(r=t.parseProperties(n),a=Object.keys(r)):(a=Object.keys(n),r=n);var s=t.defaults[e]=document.createElement("meta");s.name="data-"+e;for(var c=a.length;c--;){var l=a[c],d=r[a[c]]+"";s.dataset[l]=d,d.length&&(d=d.match(/\W/)?'="'+d+'"':"="+d),i.content+=i.content.length?","+l+d:l+d}},n.findOnPage=function(){var e=document.querySelectorAll('meta[name^="schema-"]');if(e)for(var t=e.length;t--;)this.load(e[t].name.replace(/^schema-/,""),a.SCOPE_PAGE)},n.load=function(e,n,r,o){var i,s;if(o&&e in _schemas)return this.append(e,n,r);switch(r=void 0===r?"":"-"+r,n||t.defaultScope){case a.SCOPE_LOCAL:(s=document.createElement("div")).innerHTML=localStorage.getItem("CSSql-"+e+r),i=t.listToFragment(s.childNodes);break;case a.SCOPE_SESSION:(s=document.createElement("div")).innerHTML=sessionStorage.getItem("CSSql-"+e+r),i=t.listToFragment(s.childNodes);break;case a.SCOPE_PAGE:default:i=document}return this.loadFromElement(i,e,o)},n.loadFromElement=function(e,n,r){if(r&&n in _schemas)return this.appendFromElement(e,n);name=void 0===name?"":"-"+name;var a,o=e.querySelector('meta[name="schema-'+n+'"]');if(o&&o.content){a=t.parseProperties(o.content),k=Object.keys(a);for(var i=k.length;i--;)k[i]in o.dataset&&(a[k[i]]=o.dataset[k[i]])}else(o=e.querySelector('meta[name="data-'+n+'"]'))&&(a=Object.keys(o.dataset).join(","));if(!a)return!1;this.define(n,a);for(var s=e.querySelectorAll('meta[name="data-'+n+'"]'),c=t.schemas[n],l=s.length;l--;)c.appendChild(s[l].cloneNode());return!0},n.fromIndexedDB=function(e,n,r,a,o,i){if(!indexedDB)throw Error("IndexedDB not supported");r=r||e;var s,c,l,d,u,f,h,m,p=t.schemas[e],g=t.defaults[e],v=Object.keys(g.dataset),S=v.length;i||this.delete(e),(n=indexedDB.open(n)).onerror=function(e){throw e},n.onsuccess=function(e){(s=e.target.result.transaction([r])).onerror=n.onerror,s.oncomplete=a||function(e){},(c=s.objectStore(r)).onerror=n.onerror,(l=c.openCursor(o)).onerror=n.onerror,l.onsuccess=function(e){if(d=event.target.result){for(f=d.value,u=g.cloneNode(),h=S;h--;)m=v[h],u.dataset[m]=f[m];p.appendChild(u),d.continue()}}}},n.toIndexedDB=function(e,t,n,r,a,o){var i,s,c,l,d=this.select(e,r);d&&(t=t||"CSSql",n=n||e,(i=indexedDB.open(t)).onerror=function(e){throw e},i.onsuccess=function(e){var r=e.target.result;if(-1===[].indexOf.call(r.objectStoreNames,n)){var u=i.onerror,f=i.onsuccess;return r.createObjectStore(n),r.onclose=function(e){(i=indexedDB.open(t,r.version+.1)).onerreor=u,i.onsuccess=f,i.onupgradeneeded=function(e){e.target.result.createObjectStore(n)}},void r.close()}if((s=r.transaction([n])).onerror=i.onerror,s.oncomplete=a||function(e){},(c=s.objectStore(n)).onerror=i.onerror,o)m();else{var h=c.clear();h.onnerror=i.onerror,h.onsuccess=m}function m(){for(l=d.length;l--;)c.add(d[l])}})},n.append=function(e,n,a){var o,i;if(a=void 0===a?"":"-"+a,!t.schemas[e])return!1;switch(n){case r.SCOPE_LOCAL:(i=document.createElement("div")).innerHTML=localStorage.getItem("CSSql-"+e+a),o=t.listToFragment(i.childNodes);break;case r.SCOPE_SESSION:(i=document.createElement("div")).innerHTML=sessionStorage.getItem("CSSql-"+e+a),o=t.listToFragment(i.childNodes);break;case r.SCOPE_PAGE:default:o=document}return this.appendFromElement(o,e)},n.appendFromElement=function(e,n){var r=t.schemas[n],a=e.querySelectorAll('meta[name="data-'+n+'"]');if(!r)return!1;if(a){for(var o=a.length;o--;)r.appendChild(a[o].cloneNode());return a.length}return!1},n.save=function(e,n,r,o,i){o=void 0===o?"":"-"+o;var s,c=t.getData(e,r),l=t.listToFragment(c,!0);switch(i&&l.insertBefore(_schemas[e].querySelector('meta[name^="schema"]').cloneNode(),l.firstChild),n){case a.SCOPE_LOCAL:(s=document.createElement("div")).appendChild(l),localStorage.setItem("CSSql-"+e+o,s.innerHTML);break;case a.SCOPE_SESSION:(s=document.createElement("div")).appendChild(l),sessionStorage.setItem("CSSql-"+e+o,s.innerHTML);break;case a.SCOPE_PAGE:default:r=t.parseWhere(r),i?t.listToFragment(document.querySelectorAll('meta[name="schema-'+e+'"],'+r)):t.listToFragment(document.querySelectorAll(r)),document.querySelector("head").appendChild(l)}},n.defaultValues=function(e,n){var r,a,o=_defaults[e],i=!1;if(n?n===n+""&&(n=t.parseProperties(n)):n={},o&&o.dataset)for(i={},a=(r=Object.keys(o.dataset)).length;a--;)n.hasOwnProperty(r[a])&&(o.dataset[r[a]]=n[r[a]]),i[r[a]]=o.dataset[r[a]];return i},n.properties=function(e){var n,r=t.defaults[e];return r&&r.dataset&&(n=Object.keys(r.dataset)),n},n.count=function(e,n){var r=t.getData(e,n);return!!r&&r.length},n.select=function(e,n,r,a,o){var i,s,c,l,d,u,f,h=t.defaults[e];if(h&&(c=Object.keys(h.dataset),s=(i=t.parseOrderBy(r||"",c)).length?t.getData(e,n):t.getData(e,n,a,o))){if(u=[],i.length){for(l=s.length;l--;){for(f={},d=c.length;d--;f[c[d]]=s[l].dataset[c[d]]);t.multidimBinaryInsert(f,u,i)}return t.nodeListToArray(u,a,o)}for(l=s.length;l--;)for(u[l]={},d=c.length;d--;u[l][c[d]]=s[l].dataset[c[d]]);return u}return!1},n.insert=function(e,n){var r,a,o,i,s,c,l,d=t.schemas[e],u=t.defaults[e];if(d&&u){for(Array.isArray(n)||(n=[n]),s=-1,c=n.length;++s<c;){for(r=u.cloneNode(),(l=n[s])===l+""&&(l=t.parseProperties(l)),i=(a=Object.keys(r.dataset)).length;i--;)o=a[i],r.dataset[o]=l[o];d.appendChild(r)}return s}return 0},n.update=function(e,n,r,a,o){var i,s,c,l,d,u=t.defaults[e];if(u){for(n===n+""&&(n=t.parseProperties(n)),d={},l=(s=Object.keys(n)).length;l--;)if(s[l]in u.dataset)d[s[l]]=n[s[l]];else if(s.splice(l,1),!s.length)return!1;if(i=t.getData(e,r,a,o)){for(c=i.length;c--;)for(l=s.length;l--;i[c].dataset[s[l]]=d[s[l]]);return i.length}}return!1},n.delete=function(e,n,r,a){var o,i,s;if(t.defaults[e]&&(o=t.getData(e,n,r,a))){for(s=t.schemas[e],i=o.length;i--;s.removeChild(o[i]));return o.length}return!1},a}(),MessageDeligate=function(){Object.__identseed__||(Object.__identseed__=1);var e=a.prototype,t={},n={},r=a;function a(){if(this.constructor!==a)return new a;Object.defineProperty(this,"__ident__",{value:Object.__identseed__++}),t.initialize(this)}return t.initialize=function(e){var t=n[e.__ident__]={};t.actions={},t.defaultAction=function(e,t,n){}},e.setDefault=function(e){if(!e||"function"!=typeof e)throw Error("'action' must be a function");n[this.__ident__].defaultAction=e},e.getListenerNames=function(){return Object.keys(n[this.__ident__].actions)},e.addListener=function(e,t){var r=n[this.__ident__],a=r.actions[e];if(!t||"function"!=typeof t)throw Error("'action' must be a function");return a?-1===a.indexOf(t)&&(a.push(t),!0):(r.actions[e]=[t],!0)},e.replaceListener=function(e,t,r,a){var o=n[this.__ident__].actions[e],i=o?o.indexOf(t):-1;if(!r||"function"!=typeof r)throw new Error("'newAction' must be a function");if(i>-1)return o[i]=r,!0;if(a)throw new Error("'oldAction' not found");return this.addListener(e,r)},e.removeListener=function(e,t,r){var a=n[this.__ident__],o=a.actions[e],i=o?o.indexOf(t):-1;return r?(delete a.actions[e],o):i>-1&&(o.length<=1&&delete a.actions[e],o.splice(i,1))},e.haveListener=function(e,t){var r=n[this.__ident__].actions[e];return!!((r?t?r.indexOf(t):r.length-1:-1)+1)},e.fireListener=function(e,t,r,a){var o=n[this.__ident__],i=o.actions[e];if(i&&i.length)for(var s=-1,c=i.length;++s<c;)i[s](t,r,a);else o.defaultAction(t,r,a)},e.clearAllListeners=function(){t.initialize(this)},r.destroy=function(e){e instanceof a&&delete n[e.__ident__]},a}();