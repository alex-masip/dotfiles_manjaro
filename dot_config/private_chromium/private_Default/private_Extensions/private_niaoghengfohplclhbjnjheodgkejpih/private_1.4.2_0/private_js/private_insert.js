chrome.runtime.sendMessage({"msg-type":"track-tab"},function(t,e){if(t){document.onreadystatechange=function(){if("interactive"==document.readyState){var t,e,n,r,a=[],o=document.documentElement.offsetHeight;for(t=-1,e=document.querySelectorAll("script,head");++t<e.length;){n=e[t],r=a[t]={};try{r.page=document.location.toString(),r.src=n.src.toString(),"HEAD"==n.parentElement.tagName?r.location="HEAD":(n.setAttribute("style","display:block !important;position:relative !important;width:0 !important;height: 0!important; overflow:hidden !important;"),r.location="BODY "+(n.getBoundingClientRect().top/o*100>>0)+"%",n.setAttribute("style","")),r.async=n.async}catch(t){}}var i={"msg-type":"script-info","script-info":a};chrome.runtime.sendMessage(i,function(t){})}},window.addEventListener("WASP.background",function(t){chrome.runtime.sendMessage(t.detail,function(t){})});var n=document.createElement("script"),r="("+function(){var t={trackUrlInitiator:function(t,e,n){if(e)try{throw new Error("WASP.buildStack")}catch(c){for(var r=c.stack.split(c.stack.charAt(22)),a="";(a=r.pop()).match(/WASP\./););if(!(a=(a.match(/http[^)]+/)||["",""])[0].replace(/(:[0-9]+){1,2}$/,"")))return;var o=document.createElement("a");o.href=a,a=o.href,o.href=e,e=o.href;var i=document.createEvent("CustomEvent");i.initCustomEvent("WASP.background",!0,!0,{"msg-type":"initiator","owner-url":t,"initiator-to":e,"initiator-from":a,"initiator-call":n}),window.dispatchEvent(i)}}};t.srcProperty={enumerable:!0,get:function(){return this.getAttribute("src")},set:function(e){t.trackUrlInitiator(this.ownerDocument.location.href,e,this.tagName+".src"),this.setAttribute("src",e)}},t.Image=window.Image,Image=window.Image=function(e,n){var r=new t.Image(e,n);return Object.defineProperty(r,"src",t.srcProperty),r},t.createElement=window.document.createElement,window.document.createElement=function(e,n){var r=t.createElement.call(document,e,n);switch(e.toLowerCase()){case"img":case"script":case"iframe":Object.defineProperty(r,"src",t.srcProperty)}return r},t.checkBeforeInsert=function(e,n,r){for(var a,o=[e];o.length;){for(var i=((a=o.shift()).childNodes||[]).length;i--;o.push(a.childNodes[i]));switch((a.tagName||"").toLowerCase()){case"img":case"script":case"iframe":t.trackUrlInitiator((n.location||document.location).href,a.src,r+"("+a.tagName+")")}}},t.Element=Element||window.Element,t.appendChild=t.Element.prototype.appendChild,t.Element.prototype.appendChild=function(e){return t.checkBeforeInsert(e,this.ownerDocument||document,this.tagName+".appendChild"),t.appendChild.call(this,e)},t.insertBefore=t.Element.prototype.insertBefore,t.Element.prototype.insertBefore=function(e,n){return t.checkBeforeInsert(e,this.ownerDocument||document,this.tagName+".insertBefore"),t.insertBefore.call(this,e,n)},t.replaceChild=t.Element.prototype.replaceChild,t.Element.prototype.replaceChild=function(e,n){return t.checkBeforeInsert(e,this.ownerDocument||document,this.tagName+".replaceChild"),t.replaceChild.call(this,e,n)},t.XMLHttpRequest=XMLHttpRequest||window.XMLHttpRequest,t.XHRopen=t.XMLHttpRequest.prototype.open,t.XMLHttpRequest.prototype.open=function(e,n,r,a,o){t.trackUrlInitiator(document.location.href,n,"XMLHttpRequest.open("+e+")"),t.XHRopen.apply(this,arguments)},t.write=(document||window.document).write,(document||window.document).write=function(e){for(var n=e.match(/<(?:script|iframe|img)[^>]*>/gi)||[],r=n.length;r--;){var a=(n[r].match(/src="([^"]+)"/i)||["",""])[1];a&&t.trackUrlInitiator(document.location.href,a,"document.write()")}t.write.call(this,e)},t.writeln=(document||window.document).writeln,(document||window.document).writeln=function(e){for(var n=e.match(/<(?:script|iframe|img)[^>]*>/gi)||[],r=n.length;r--;){var a=(n[r].match(/src="([^"]+)"/i)||["",""])[1];a&&t.trackUrlInitiator(document.location.href,a,"document.writeln()")}t.writeln.call(this,e)},t.datalayer={name:"",stack:[],count:0},t.datalayer.send=function(){var e,n,r,a,o,i,c,s=t.datalayer.stack,l={"msg-type":"datalayer",for:t.datalayer.name,items:[]};for(e=t.datalayer.count-1,n=s.length;++e<n;){var d=[];if(s[e]instanceof Object)for(s[e]instanceof Array&&d.push({name:"array",value:s[e].length}),a=-1,o=(r=Object.keys(s[e])).length;++a<o;)i=s[e][r[a]],d.push({name:r[a],value:i&&i.toString?i.toString():String(i)});else i=s[e],d.push({name:typeof i,value:i&&i.toString?i.toString():String(i)});l.items.push(d)}l.items.length&&(t.datalayer.count=s.length,(c=document.createEvent("CustomEvent")).initCustomEvent("WASP.background",!0,!0,l),window.dispatchEvent(c)),window.setTimeout(t.datalayer.send,500)},t.datalayer.tries=0,t.datalayer.find=function(){var e=document.querySelector('script[src*="googletagmanager.com"]');e&&e.src&&(t.datalayer.name=(e.src.match(/&l=(.*)$/)||["","dataLayer"])[1],t.datalayer.stack=e=window[t.datalayer.name]),e?t.datalayer.send():++t.datalayer.tries<5&&window.setTimeout(t.datalayer.send,1e3*t.datalayer.tries)},window.addEventListener("load",t.datalayer.find)}+")();";if(e&&e.length)for(var a=-1,o=e.length;++a<o;)r+="\n\n"+e[a];n.textContent=r,(document.head||document.documentElement).appendChild(n),n.parentNode.removeChild(n)}});